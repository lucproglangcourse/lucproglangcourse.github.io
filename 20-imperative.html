<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="4. The Object-Oriented Programming Paradigm" href="30-objectoriented.html" /><link rel="prev" title="2. Context and Background" href="10-background.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>3. The Imperative Programming Paradigm - Loyola University Chicago COMP 371/471 Lecture Notes v25f.14</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Loyola University Chicago COMP 371/471 Lecture Notes v25f.14</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">Loyola University Chicago COMP 371/471 Lecture Notes v25f.14</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="05-overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-background.html">2. Context and Background</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">3. The Imperative Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="30-objectoriented.html">4. The Object-Oriented Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="40-functional.html">5. The Functional Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="50-representationinterpretation.html">6. Program Representation and Interpretation</a></li>
<li class="toctree-l1"><a class="reference internal" href="60-concurrency.html">7. The Concurrent Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="70-logic.html">8. The Logic Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="75-otherparadigms.html">9. Other Important Programming Paradigms</a></li>
<li class="toctree-l1"><a class="reference internal" href="78-summary.html">10. Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="80-principles.html">11. Appendix: Programming Language Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="83-resources.html">12. Appendix: Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="85-software.html">13. Appendix: Course Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="90-syllabus.html">14. Appendix: Course Syllabi</a></li>
<li class="toctree-l1"><a class="reference internal" href="95-todo.html">15. Appendix: TODO</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/20-imperative.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="the-imperative-programming-paradigm">
<h1><span class="section-number">3. </span>The Imperative Programming Paradigm<a class="headerlink" href="#the-imperative-programming-paradigm" title="Link to this heading"></a></h1>
<p>In this chapter, we discuss the <em>imperative programming paradigm</em> with examples in Scala.
To differentiate this from the object-oriented paradigm in practice, we define imperative code to mean code that uses a language’s mutable named state (variables) and control-flow constructs (conditionals, loops, procedural abstraction) along with its built-in types, including primitive types and built-in type abstractions for strings, collections, input/output, and other general-purpose building blocks.
By contrast, we define object-oriented code to mean code that includes definitions of domain models or other new application-specific abstractions, or uses object-oriented frameworks (as opposed to lower-level, general-purpose object-oriented libraries).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Arguably, this definition of the imperative paradigm may be closer to a definition of the <em>scripting style</em> because most imperative languages do provide mechanisms for introducing new type abstractions.
For pedagogical reasons, we will still discuss those capabilities the next chapter as part of the object-oriented paradigm.</p>
</div>
<section id="core-elements">
<h2><span class="section-number">3.1. </span>Core elements<a class="headerlink" href="#core-elements" title="Link to this heading"></a></h2>
<p>The imperative paradigm is characterized by <em>commands that change a program’s state</em>.
A program in this style specifies <em>how</em> to achieve a desired result, step by step,
through a sequence of statements that manipulate named mutable state.</p>
<p>This paradigm is closely tied to and naturally supported by the von Neumann machine architecture, where a processor fetches instructions and data from a memory, operates on the data, and writes the results back into memory. Computation is accomplished by making small incremental changes in the global memory. For more details, see also <a class="reference external" href="https://unoapi.org/05-parallel/parallel.html#von-neumann-machines-and-their-limits">this reference</a>.</p>
<section id="named-mutable-state">
<h3><span class="section-number">3.1.1. </span>Named Mutable State<a class="headerlink" href="#named-mutable-state" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Variables</strong> are identifiers bound to memory locations whose contents can be updated.</p></li>
<li><p><strong>State</strong> refers to the current values of all variables at a given point in time.</p></li>
<li><p>State changes are performed through assignment statements.</p></li>
</ul>
</section>
<section id="control-flow">
<h3><span class="section-number">3.1.2. </span>Control Flow<a class="headerlink" href="#control-flow" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Sequential execution</strong>: statements run one after another in order.</p></li>
<li><p><strong>Branching</strong>: conditional statements choose between alternative paths.</p></li>
<li><p><strong>Repetition/Iteration</strong>: loops repeat computations until conditions are met.</p></li>
</ul>
</section>
<section id="procedural-abstraction">
<h3><span class="section-number">3.1.3. </span>Procedural Abstraction<a class="headerlink" href="#procedural-abstraction" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Procedures, functions, and methods</strong> group statements into reusable units.</p></li>
<li><p><strong>Parameter passing</strong> mechanisms:</p>
<ul>
<li><p><em>Call by value</em>: actual argument evaluated and copied into the formal parameter.</p></li>
<li><p><em>Call by reference</em>: actual argument passed as an address, allowing mutation.</p></li>
<li><p><em>Call by name</em>: actual argument expression substituted into the procedure body (rare, but historically important, e.g., Algol 60).</p></li>
</ul>
</li>
</ul>
</section>
<section id="other-elements">
<h3><span class="section-number">3.1.4. </span>Other Elements<a class="headerlink" href="#other-elements" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Block structure and scope</strong>: delimit visibility and lifetime of variables.</p></li>
<li><p><strong>Side effects</strong>: operations that modify state beyond returning values.</p></li>
<li><p><strong>I/O as imperative commands</strong>: reading/writing inherently changes program state.</p></li>
</ul>
</section>
<section id="examples-across-languages">
<h3><span class="section-number">3.1.5. </span>Examples Across Languages<a class="headerlink" href="#examples-across-languages" title="Link to this heading"></a></h3>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Element</p></th>
<th class="head"><p>C</p></th>
<th class="head"><p>Java</p></th>
<th class="head"><p>Scala</p></th>
<th class="head"><p>Python</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Named mutable state</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">5;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">5;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">5</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">5</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Sequential execution</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">2;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">2;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">a</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">val</span> <span class="pre">b</span> <span class="pre">=</span> <span class="pre">2</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">b</span> <span class="pre">=</span> <span class="pre">2</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Branching</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(x</span> <span class="pre">&gt;</span> <span class="pre">0)</span> <span class="pre">{...}</span> <span class="pre">else</span> <span class="pre">{...}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(x</span> <span class="pre">&gt;</span> <span class="pre">0)</span> <span class="pre">{...}</span> <span class="pre">else</span> <span class="pre">{...}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(x</span> <span class="pre">&gt;</span> <span class="pre">0)</span> <span class="pre">...</span> <span class="pre">else</span> <span class="pre">...</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">0:\n</span>&#160;&#160;&#160; <span class="pre">...\nelse:\n</span>&#160;&#160;&#160; <span class="pre">...</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Iteration</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(i=0;i&lt;n;i++)</span> <span class="pre">{...}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(int</span> <span class="pre">i=0;i&lt;n;i++)</span> <span class="pre">{...}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(i</span> <span class="pre">&lt;-</span> <span class="pre">0</span> <span class="pre">until</span> <span class="pre">n)</span> <span class="pre">{...}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range(n):</span> <span class="pre">...</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Procedure / method</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">f(int</span> <span class="pre">x){</span> <span class="pre">return</span> <span class="pre">x+1;</span> <span class="pre">}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">f(int</span> <span class="pre">x){</span> <span class="pre">return</span> <span class="pre">x+1;</span> <span class="pre">}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(x:Int)</span> <span class="pre">=</span> <span class="pre">x+1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(x):</span> <span class="pre">return</span> <span class="pre">x+1</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Call by value</p></td>
<td><p>Default (<code class="docutils literal notranslate"><span class="pre">f(x)</span></code>)</p></td>
<td><p>Default (<code class="docutils literal notranslate"><span class="pre">f(x)</span></code>)</p></td>
<td><p>Default (<code class="docutils literal notranslate"><span class="pre">f(x)</span></code>)</p></td>
<td><p>Default (<code class="docutils literal notranslate"><span class="pre">f(x)</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p>Call by reference</p></td>
<td><p>Pointers (<code class="docutils literal notranslate"><span class="pre">f(&amp;x)</span></code>)</p></td>
<td><p>Not supported (simulated with mutable objects)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">var</span></code> parameters in Scala 2 (removed in 3)</p></td>
<td><p>Not supported (mutable objects simulate)</p></td>
</tr>
<tr class="row-odd"><td><p>Call by name</p></td>
<td><p>Not directly supported (simulated with macros)</p></td>
<td><p>Not supported</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(x:</span> <span class="pre">=&gt;</span> <span class="pre">Int)</span></code> (lazy eval of argument)</p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p>Scope</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">int</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">int</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">val</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">0</span> <span class="pre">}</span></code></p></td>
<td><p>Indentation-based block</p></td>
</tr>
<tr class="row-odd"><td><p>Side effect</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x++</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x++</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">+=</span> <span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">+=</span> <span class="pre">1</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="discussion">
<h3><span class="section-number">3.1.6. </span>Discussion<a class="headerlink" href="#discussion" title="Link to this heading"></a></h3>
<p>Imperative constructs form the foundation of nearly all mainstream programming
languages, even those that emphasize other paradigms. They provide a natural
model of computation as a <em>state machine</em>: a program moves from one state to the next
through explicit updates governed by control flow.</p>
</section>
</section>
<section id="options-for-running-scala-code">
<h2><span class="section-number">3.2. </span>Options for running Scala code<a class="headerlink" href="#options-for-running-scala-code" title="Link to this heading"></a></h2>
<p>In this section, we discuss the different options for running Scala code, including applications and tests.</p>
<ul>
<li><p>The simplest way to run Scala code fragments is through the Scala REPL (read-eval-print loop).
We can launch the Scala REPL and then evaluate definitions and expressions:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">$</span><span class="w"> </span><span class="n">scala</span>
<span class="nc">Welcome</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nc">Scala</span><span class="w"> </span><span class="mf">3.2.0</span><span class="w"> </span><span class="p">(</span><span class="mf">17.0.4.1</span><span class="p">,</span><span class="w"> </span><span class="nc">Java</span><span class="w"> </span><span class="nc">OpenJDK</span><span class="w"> </span><span class="mi">64</span><span class="o">-</span><span class="nc">Bit</span><span class="w"> </span><span class="nc">Server</span><span class="w"> </span><span class="nc">VM</span><span class="p">).</span>
<span class="nc">Type</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">expressions</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">evaluation</span><span class="p">.</span><span class="w"> </span><span class="nc">Or</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="p">:</span><span class="n">help</span><span class="p">.</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span>
<span class="n">res0</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
<span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="nc">Int</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">res1</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">z</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">Seq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">res2</span><span class="p">:</span><span class="w"> </span><span class="nc">Seq</span><span class="p">[</span><span class="nc">Int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a very effective, painless way to conduct initial explorations.
The drawback of this approach is a lack of support for <em>managed dependencies</em>, which are required for more advanced work.
In that case, starting the Scala REPL through sbt as discussed below is a much better choice.
Managing the Scala/Java classpath manually is discouraged.</p>
<p>You can also run simple scripts (with optional command-line arguments) directly through the scala interpreter. A <code class="docutils literal notranslate"><span class="pre">main</span></code> method or <code class="docutils literal notranslate"><span class="pre">&#64;main</span></code> annotation is required, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>&gt;<span class="w"> </span>blah.scala
def<span class="w"> </span>main<span class="o">(</span>args:<span class="w"> </span>Array<span class="o">[</span>String<span class="o">])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>println<span class="o">(</span>args.toList<span class="o">)</span>
$<span class="w"> </span>scala<span class="w"> </span>blah.scala<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span>
List<span class="o">(</span><span class="m">1</span>,<span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span>
</pre></div>
</div>
</li>
<li><p>In a Scala IDE such as IntelliJ IDEA, we can run Scala applications (classes/objects with a <code class="docutils literal notranslate"><span class="pre">main</span></code> method) and Scala tests from within the IDE. To pass command-line arguments to an application, we have to create a suitable run configuration.</p></li>
<li><p>It is best to use <a class="reference external" href="https://www.scala-sbt.org/">sbt</a> (the Scala Build Tool) for projects with one or more external dependencies because of sbt’s (and similar build tools’) ability to manage these dependencies in a declarative way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbt<span class="w"> </span><span class="nb">test</span>
$<span class="w"> </span>sbt<span class="w"> </span>run
$<span class="w"> </span>sbt<span class="w"> </span><span class="s2">&quot;run arg1 arg2 ...&quot;</span>
$<span class="w"> </span>sbt<span class="w"> </span><span class="s2">&quot;runMain my.pkg.Main arg1 arg2 ...&quot;</span>
$<span class="w"> </span>sbt<span class="w"> </span>test:run
</pre></div>
</div>
<p>In addition, sbt allows you to start a REPL that exposes the code in your project and its managed dependencies.
This is the preferred way to explore existing libraries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbt<span class="w"> </span>console
</pre></div>
</div>
<p>You can also pull in the additional dependencies from the test scope:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbt<span class="w"> </span>test:console
</pre></div>
</div>
<p>If you want to bypass your own code in case of, say, compile-time errors, you can use one of these tasks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbt<span class="w"> </span>consoleQuick
$<span class="w"> </span>sbt<span class="w"> </span>test:consoleQuick
</pre></div>
</div>
<p>In conjunction with a <a class="reference external" href="https://www.gnu.org/software/emacs">text editor</a>, sbt’s <a class="reference external" href="https://www.scala-sbt.org/1.x/docs/Triggered-Execution.html">triggered execution</a> for testing will significantly shorten the edit-compile-run/test cycle, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbt
...
&gt;<span class="w"> </span>~<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
</li>
<li><p>In general, irrespective of your choice of development environment, a convenient way to do exploratory programming beyond the basic REPL is to start with a single test.
There, you can develop your ideas and interact with the library APIs you want to explore.
For simple testing, you can intersperse assertions within your code or use the testing support provided by the chosen testing framework, e.g., <a class="reference external" href="https://junit.org/">JUnit</a> or <a class="reference external" href="https://www.scalatest.org/">ScalaTest</a>.
So you can start exploring something in a test and then move it into your production code (<cite>main</cite> folder) when appropriate.
<a class="reference external" href="https://github.com/lucproglangcourse/cs2-listperformance-scala/blob/main/src/test/scala/cs271/lab/list/TestList.scala">The list performance example</a> illustrates this approach.</p></li>
<li><p>Finally, to turn an sbt-based Scala application into a script (command-line application) you can run outside sbt, you can use the <a class="reference external" href="https://github.com/sbt/sbt-native-packager">sbt-native-packager</a> plugin.
To use this plugin, add this line to the end of <code class="docutils literal notranslate"><span class="pre">build.sbt</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>enablePlugins<span class="o">(</span>JavaAppPackaging<span class="o">)</span>
</pre></div>
</div>
<p>and this one to <code class="docutils literal notranslate"><span class="pre">project/plugins.sbt</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">addSbtPlugin</span><span class="p">(</span><span class="s">&quot;com.typesafe.sbt&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;sbt-native-packager&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.7.5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, after any change to your sources, you can create/update the script and run it from the command line like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbt<span class="w"> </span>stage
...
$<span class="w"> </span>./target/universal/stage/bin/myapp-scala<span class="w"> </span>arg1<span class="w"> </span>arg2<span class="w"> </span>...
</pre></div>
</div>
</li>
</ul>
</section>
<section id="techniques-for-testing-scala-code">
<h2><span class="section-number">3.3. </span>Techniques for testing Scala code<a class="headerlink" href="#techniques-for-testing-scala-code" title="Link to this heading"></a></h2>
<p>Testing is an important, widely used practice within the software development lifecycle (SDLC).
There are various basic techniques and libraries/frameworks for testing Scala code.</p>
<p>The simplest way is to intersperse assertions within your code.
This is particularly effective for scripts and worksheets:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">assert</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The following testing libraries/frameworks work well with Scala.</p>
<ul class="simple">
<li><p>The familiar <a class="reference external" href="http://junit.org">JUnit</a> can be used directly.</p></li>
<li><p><a class="reference external" href="http://scalacheck.org">ScalaCheck</a> is a testing framework for Scala that emphasizes property-based testing, including universally quantified properties, such as “for all lists <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>, the value of <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">++</span> <span class="pre">y).length</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">x.length</span> <span class="pre">+</span> <span class="pre">y.length</span></code>”</p></li>
<li><p><a class="reference external" href="http://scalatest.org">ScalaTest</a> is a testing framework for Scala that supports a broad range of test styles including behavior-driven design, including integration with ScalaCheck.</p></li>
<li><p><a class="reference external" href="http://etorreborre.github.io/specs2">specs2</a> is a specification-based testing library that also supports integration with ScalaCheck.</p></li>
<li><p><a class="reference external" href="https://github.com/scalameta/munit">MUnit</a> is a newer testing library for Scala.</p></li>
</ul>
<p>The <a class="reference external" href="https://github.com/lucproglangcourse/echotest-scala">echotest</a> example shows some of these libraries in action.</p>
<p>For faster turnaround during development, we can combine these techniques with <a class="reference external" href="https://www.scala-sbt.org/1.x/docs/Triggered-Execution.html">triggered execution</a>.</p>
<section id="measuring-code-coverage">
<h3><span class="section-number">3.3.1. </span>Measuring code coverage<a class="headerlink" href="#measuring-code-coverage" title="Link to this heading"></a></h3>
<p>The <em>code coverage</em> of your tests indicates how thoroughly you’re testing.
Typically, you would use the <a class="reference external" href="https://github.com/scoverage/sbt-scoverage">sbt scoverage plugin</a> to meaasure what percentage of your main code are covered by your tests.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sbt<span class="w"> </span>clean<span class="w"> </span>coverage<span class="w"> </span><span class="nb">test</span><span class="w"> </span>coverageReport
</pre></div>
</div>
<p>Once these tasks complete, you should see the coverage percentages toward the end of the terminal output,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>Statement<span class="w"> </span>coverage.:<span class="w"> </span><span class="m">50</span>.91%
<span class="o">[</span>info<span class="o">]</span><span class="w"> </span>Branch<span class="w"> </span>coverage....:<span class="w"> </span><span class="m">50</span>.00%
</pre></div>
</div>
<p>and your test reports should then be available at</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>target/scala-*/scoverage-report/index.html
</pre></div>
</div>
<p>When you open this file in your web browser (or preview it in Gitpod using the <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.live-server">Live Preview extension</a>), you will see a navigable visualization of the code coverage report.</p>
<img alt="_images/ScoverageOverview.png" src="_images/ScoverageOverview.png" />
<p>Here you can drill into specific packages and classes.
When looking at a class, you can switch between the source code view and an abstract statement view.</p>
<img alt="_images/ScoverageCode.png" src="_images/ScoverageCode.png" />
<img alt="_images/ScoverageStatements.png" src="_images/ScoverageStatements.png" />
<p>If your coverage percentages appear low, you can make them more accurate by excluding classes you are not testing programmatically, such as those focused on providing a main method responsible mostly for I/O.
(This works only with Scala version 3.4.2 or higher; also check <code class="docutils literal notranslate"><span class="pre">project/plugins.sbt</span></code> to make sure you’re running the latest version of the sbt-scoverage plugin.)</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">ccoverageExcludedPackages</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;&quot;&quot;.*\.simple\..*;.*\.common.*;.*\.Main;benchmark\..*&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Additional information on testing is available in the corresponding section of the <a class="reference external" href="https://lucformalmethodscourse.github.io/30-testing.html">COMP 335/435: Formal Methods lecture notes</a>.</p>
</section>
<section id="end-to-end-application-testing">
<h3><span class="section-number">3.3.2. </span>End-to-end application testing<a class="headerlink" href="#end-to-end-application-testing" title="Link to this heading"></a></h3>
<p>Besides the familiar styles of unit testing, one could attempt to automate the process of end-to-end application testing.
One approach would be to use shell scripts in conjunction with sample input and expected output files;
after running the application on the sample input, one could use a <code class="docutils literal notranslate"><span class="pre">diff</span></code> utility to compare the actual output to the expected output.</p>
<p>This approach adds complexity in terms of maintaining an additional set of data files, however, and it is brittle in that the test may no longer be valid after changes in the output format of the application under test.
Therefore, it is usually preferable to use the unit testing techniques described above at the data structure level as opposed to comparing formatted output.</p>
<p>On the other hand, if one really wants to test the I/O code, one could set up programmatic end-to-end application tests as part of an automated test suite by redirecting the standard input and output to in-memory streams one can populate or examine programmatically.
This approach appears to work within IDEs such as IntelliJ but not in a standalone invocation of sbt.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@Test</span>
<span class="k">def</span><span class="w"> </span><span class="nf">testMainEndToEnd</span><span class="p">:</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">ByteArrayOutputStream</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">PrintStream</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span>
<span class="w">  </span><span class="nc">System</span><span class="p">.</span><span class="n">setOut</span><span class="p">(</span><span class="n">os</span><span class="p">)</span><span class="w"> </span><span class="c1">// redirect stdout to the in-memory stream</span>
<span class="w">  </span><span class="n">main</span><span class="p">.</span><span class="nc">Main</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="nc">Array</span><span class="p">.</span><span class="n">empty</span><span class="p">[</span><span class="nc">String</span><span class="p">])</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="k">import</span><span class="w"> </span><span class="nn">scala</span><span class="p">.</span><span class="nn">language</span><span class="p">.</span><span class="n">unsafeNulls</span>
<span class="w">    </span><span class="n">ba</span><span class="p">.</span><span class="n">toString</span><span class="p">.</span><span class="n">lines</span><span class="p">.</span><span class="n">toList</span><span class="p">.</span><span class="n">asScala</span>
<span class="w">  </span><span class="n">assertEquals</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lines</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="w">  </span><span class="n">assertEquals</span><span class="p">(</span><span class="s">&quot;hello hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lines</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="the-role-of-command-line-applications">
<h2><span class="section-number">3.4. </span>The role of command-line applications<a class="headerlink" href="#the-role-of-command-line-applications" title="Link to this heading"></a></h2>
<p>Command-line applications have always been an important part of the UNIX environment.
Each application typically focuses on a specific task, and several applications can be composed to solve a more complex task.</p>
<p>The typical command-line application interacts with its environment in the following ways:</p>
<ul class="simple">
<li><p><em>environment variables</em> defined in your system</p></li>
<li><p>zero or more application-specific <em>command-line arguments</em> for passing options to the application: <code class="docutils literal notranslate"><span class="pre">app</span> <span class="pre">arg1</span> <span class="pre">arg2</span> <span class="pre">...</span></code></p></li>
<li><p><em>standard input</em> (stdin) for reading the input data</p></li>
<li><p><em>standard output</em> (stdout) for writing the output data</p></li>
<li><p><em>standard error</em> (stderr) for displaying error messages separately from the output data</p></li>
</ul>
<p>From a Scala perspective, environment variables are accessible via the predefined <code class="docutils literal notranslate"><span class="pre">sys.env</span></code> map, e.g., <code class="docutils literal notranslate"><span class="pre">sys.env(&quot;HOME&quot;)</span></code>, and command-line arguments are accessible via the main method’s argument <code class="docutils literal notranslate"><span class="pre">args</span></code> (a string array).
Similar mechanisms are available in Java and other JVM languages.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In addition, languages running on a Java Virtual Machine (JVM) support <em>properties</em> defined through command-line arguments of the form <code class="docutils literal notranslate"><span class="pre">-Dmy.prop=someValue</span></code> and accessible via, e.g., <code class="docutils literal notranslate"><span class="pre">sys.props(&quot;my.prop&quot;)</span></code>.</p>
</div>
<p>Applications that read and write from and to the standard data streams can function as composable building blocks using UNIX pipes.
Using these standard I/O mechanisms is much more flexible than reading from or writing to specific files whose names are hardcoded in the program.</p>
<p>E.g., the <code class="docutils literal notranslate"><span class="pre">yes</span></code> command outputs its arguments forever on consecutive output lines,
the <code class="docutils literal notranslate"><span class="pre">head</span></code> command outputs a finite prefix of its input,
and the <code class="docutils literal notranslate"><span class="pre">wc</span></code> command counts the number of characters, words, or lines:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>yes<span class="w"> </span>hello<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</pre></div>
</div>
<p>You may wonder how the upstream (left) stages in the pipeline know when to terminate.
Concretely, how does the <code class="docutils literal notranslate"><span class="pre">yes</span></code> command know to terminate after <code class="docutils literal notranslate"><span class="pre">head</span></code> reads the first ten lines.
When <code class="docutils literal notranslate"><span class="pre">head</span></code> is done after reading and passing through the specified number of lines, it closes its input stream, and <code class="docutils literal notranslate"><span class="pre">yes</span></code> will receive an error signal called <code class="docutils literal notranslate"><span class="pre">SIGPIPE</span></code> when it tries to write further data to that stream.
The default response to this error signal is termination.
For more details on <code class="docutils literal notranslate"><span class="pre">SIGPIPE</span></code>, see <a class="reference external" href="https://unix.stackexchange.com/a/84828">this StackExchange response</a>.</p>
<p>We can also use the control structures built into the shell. E.g., the following loop prints an infinite sequence of consecutive integers starting from 0:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">n</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">while</span><span class="w"> </span>:<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$n</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">((</span><span class="nv">n</span><span class="o">=</span>n+1<span class="o">))</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>These techniques are useful for producing test data for our own applications.
To this end, we can redirect output to a newly created file using this syntax:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">n</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">while</span><span class="w"> </span>:<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$n</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">((</span><span class="nv">n</span><span class="o">=</span>n+1<span class="o">))</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="w"> </span>&gt;<span class="w"> </span>testdata.txt
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">testdata.txt</span></code> already exists, it will be overwritten when using this syntax.
We can also append to an existing file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>...<span class="w"> </span>&gt;&gt;<span class="w"> </span>testdata.txt
</pre></div>
</div>
<p>Similarly, we can redirect input from a file using this notation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>&lt;<span class="w"> </span>testdata.txt
</pre></div>
</div>
<p>There is a close relationship between UNIX pipes and functional programming: When viewing a command-line application as a function that transforms its input to its output, UNIX pipes correspond to function composition. The pipeline <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">|</span> <span class="pre">q</span></code> corresponds to the function composition <code class="docutils literal notranslate"><span class="pre">q</span> <span class="pre">o</span> <span class="pre">p</span></code>.</p>
<section id="command-line-applications-in-scala">
<h3><span class="section-number">3.4.1. </span>Command-line applications in Scala<a class="headerlink" href="#command-line-applications-in-scala" title="Link to this heading"></a></h3>
<p>The following techniques are useful for creating command-line applications in Scala.
As in Java, command-line arguments are available to a Scala application as <code class="docutils literal notranslate"><span class="pre">args</span></code> of type <code class="docutils literal notranslate"><span class="pre">Array[String]</span></code>.</p>
<p>We can read the standard input as lines using this iterator:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="nc">Source</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="n">getLines</span><span class="p">()</span>
</pre></div>
</div>
<p>This gives you an iterator of strings with each item representing one line. When the iterator has no more items, you are done reading all the input. (See also this <a class="reference external" href="https://alvinalexander.com/scala/how-to-open-read-text-files-in-scala-cookbook-examples">concise reference</a>.)</p>
<p>To break this iterator of lines down into an iterator of words, we can use this recipe:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="k">import</span><span class="w"> </span><span class="nn">scala</span><span class="p">.</span><span class="nn">language</span><span class="p">.</span><span class="n">unsafeNulls</span>
<span class="w">  </span><span class="n">lines</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;(?U)[^\\p{Alpha}0-9&#39;]+&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>(We’ll discuss <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> in detail later.)</p>
<p>The result of <code class="docutils literal notranslate"><span class="pre">l.split(regex)</span></code> is an array of strings, where some of the strings or the entire array could possibly be <code class="docutils literal notranslate"><span class="pre">null</span></code> because <code class="docutils literal notranslate"><span class="pre">split</span></code> is a Java method, where the stated <code class="docutils literal notranslate"><span class="pre">String</span></code> type really means <code class="docutils literal notranslate"><span class="pre">String</span></code> or <code class="docutils literal notranslate"><span class="pre">null</span></code>.
While <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> is supposed to preserve the element type of the transformed iterator, splitting the lines in this way could introduce <code class="docutils literal notranslate"><span class="pre">null</span></code> references.
Because we require <a class="reference external" href="https://docs.scala-lang.org/scala3/reference/experimental/explicit-nulls.html">explicit typing of null references</a> (by adding <code class="docutils literal notranslate"><span class="pre">&quot;-Yexplicit-nulls&quot;</span></code> to the compiler options in <code class="docutils literal notranslate"><span class="pre">build.sbt</span></code>), the Scala compiler considers this code incorrect and indicates an error unless we enable this potentially unsafe use of implicit null references.</p>
<p><em>To keep null safety in place as widely as possible, it is best to keep this import local to the block(s) performing IO code.
In some cases, it is more convenient to use the</em> <code class="docutils literal notranslate"><span class="pre">.nn</span></code> <em>extension method to disable null safety for a single expression, e.g.,</em></p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">System</span><span class="p">.</span><span class="n">err</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;D&#39;oh!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, the Java virtual machine converts the <code class="docutils literal notranslate"><span class="pre">SIGPIPE</span></code> error signal to an <code class="docutils literal notranslate"><span class="pre">IOException</span></code>.
In Scala, <code class="docutils literal notranslate"><span class="pre">print</span></code> and <code class="docutils literal notranslate"><span class="pre">println</span></code> print to stdout, which is is an instance of <code class="docutils literal notranslate"><span class="pre">PrintStream</span></code>.
This class converts any <code class="docutils literal notranslate"><span class="pre">IOException</span></code> to a boolean flag accessible through its <code class="docutils literal notranslate"><span class="pre">checkError()</span></code> method.
(See also <a class="reference external" href="https://stackoverflow.com/questions/62658078/jvm-not-killed-on-sigpipe">this discussion</a> for more details.)</p>
<p>Therefore, to use a Scala (or Java) command-line application in a UNIX pipeline as an upstream component that produces an unbounded (potentially infinite) output sequence, we have to monitor this flag when printing to stdout and, if necessary, terminate execution.</p>
<p>For example, this program reads one line at a time and prints the line count along with the line read.
After printing, it checks whether an error occured and, if necessary, terminates execution by exiting the program:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">println</span><span class="p">((</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">))</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">checkError</span><span class="p">()</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="command-line-argument-parsing">
<h3><span class="section-number">3.4.2. </span>Command-line argument parsing<a class="headerlink" href="#command-line-argument-parsing" title="Link to this heading"></a></h3>
<p>A common concern when developing command-line applications is argument and option parsing.
As briefly mentioned above, arguments and options are application-specific settings we can pass an application in the form <code class="docutils literal notranslate"><span class="pre">app</span> <span class="pre">arg1</span> <span class="pre">arg2</span> <span class="pre">...</span></code> at the time when we’re invoking the application.
Importantly, these settings are separate from the application’s input data.</p>
<p>E.g., in our <a class="reference external" href="https://github.com/lucproglangcourse/consoleapp-java">sliding queue example</a>, we keep a sliding queue of the n most recent words read from the input;
therefore, when invoking this application, we need to choose a specific value for n.
This is something we would typically use command-line arguments for.</p>
<p>Since the C language days, applications have received their command-line arguments as an array of strings;
this is still the case in the Java/Scala world, where the main entry point receives the command-line arguments as a string array.
We can examine these arguments programmatically, make sure there are the correct number of them, convert them to numbers as needed, etc.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// perform argument validity checking</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">err</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;usage: ./target/universal/stage/bin/consoleapp [ last_n_words ]&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// ...</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">lastNWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastNWords</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NumberFormatException</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Command-line arguments are very widely used, but it quickly becomes tedious to handle them when more than one or two arguments are required and when we want to have <em>named</em> arguments instead of position-based ones so we can provide them in any order.
Unsurprisingly, as is the case for many common tasks or concerns not addressed by the standard library bundled with the language SDK, there are third-party libraries for handling command-line argument parsing.</p>
<p>For example, we can use Li Haoyi’s <a class="reference external" href="https://github.com/com-lihaoyi/mainargs">mainargs</a> library by declaring this dependency in our build configuration</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;com.lihaoyi&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;mainargs&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;0.6.3&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">mainargs</span><span class="p">.{</span><span class="n">main</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="nc">ParserForMethods</span><span class="p">,</span><span class="w"> </span><span class="nc">Flag</span><span class="p">}</span>

<span class="c1">// ...</span>

<span class="c1">// external entry point into Scala application</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]):</span><span class="w"> </span><span class="nc">Unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ParserForMethods</span><span class="p">(</span><span class="bp">this</span><span class="p">).</span><span class="n">runOrExit</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">toIndexedSeq</span><span class="p">)</span>

<span class="c1">// internal main method with arguments annotated for parsing</span>
<span class="nd">@main</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@arg</span><span class="p">(</span><span class="n">short</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;size of the sliding word cloud&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">cloudSize</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@arg</span><span class="p">(</span><span class="n">short</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;l&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;minimum word length to be considere&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">minLength</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@arg</span><span class="p">(</span><span class="n">short</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;w&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;size of the sliding FIFO queue&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">windowSize</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@arg</span><span class="p">(</span><span class="n">short</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;number of steps between word cloud updates&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">everyKSteps</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@arg</span><span class="p">(</span><span class="n">short</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;f&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;minimum frequency for a word to be included in the cloud&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">minFrequency</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>

<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">f&quot;howMany=</span><span class="si">$</span><span class="n">cloudSize</span><span class="s"> minLength=</span><span class="si">$</span><span class="n">minLength</span><span class="s"> lastNWords=</span><span class="si">$</span><span class="n">windowSize</span><span class="s"> everyKSteps=</span><span class="si">$</span><span class="n">everyKSteps</span><span class="s"> minFrequency=</span><span class="si">$</span><span class="n">minFrequency</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// ...</span>
</pre></div>
</div>
<p>Based on the formal argument names and their <code class="docutils literal notranslate"><span class="pre">&#64;arg</span></code> annotations, the library generates a parser that looks for the arguments based on their long or short names and associated values;
arguments can have default values.
In addition, the generated code can handle a <code class="docutils literal notranslate"><span class="pre">--help</span></code> option, which prints a UNIX-style usage summary.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./target/universal/stage/bin/myapp<span class="w"> </span>--<span class="w"> </span>--help
run
<span class="w">  </span>-c<span class="w"> </span>--cloud-size<span class="w"> </span>&lt;int&gt;<span class="w">     </span>size<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>sliding<span class="w"> </span>word<span class="w"> </span>cloud
<span class="w">  </span>-l<span class="w"> </span>--min-length<span class="w"> </span>&lt;int&gt;<span class="w">     </span>minimum<span class="w"> </span>word<span class="w"> </span>length<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>considere
<span class="w">  </span>-w<span class="w"> </span>--window-size<span class="w"> </span>&lt;int&gt;<span class="w">    </span>size<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>sliding<span class="w"> </span>FIFO<span class="w"> </span>queue
<span class="w">  </span>-s<span class="w"> </span>--every-ksteps<span class="w"> </span>&lt;int&gt;<span class="w">   </span>number<span class="w"> </span>of<span class="w"> </span>steps<span class="w"> </span>between<span class="w"> </span>word<span class="w"> </span>cloud<span class="w"> </span>updates
<span class="w">  </span>-f<span class="w"> </span>--min-frequency<span class="w"> </span>&lt;int&gt;<span class="w">  </span>minimum<span class="w"> </span>frequency<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>word<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>included<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>cloud
</pre></div>
</div>
<p>For example, we could run the application with these arguments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./target/universal/stage/bin/myapp<span class="w"> </span>--<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span>-l<span class="w"> </span><span class="m">2</span><span class="w"> </span>-w<span class="w"> </span><span class="m">5</span>
</pre></div>
</div>
</section>
<section id="determining-whether-an-app-is-running-interactively">
<h3><span class="section-number">3.4.3. </span>Determining whether an app is running interactively<a class="headerlink" href="#determining-whether-an-app-is-running-interactively" title="Link to this heading"></a></h3>
<p>In some cases, it’s convenient to determine programmatically whether our command-line app is running interactively, i.e., reading from the console, or running in batch mode, where its standard input has been redirected from a file.
For example, if our app running interactively, we might automatically want to prompt the user for console input.</p>
<p>We can use this technique to determine whether stdin is coming from the console.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">private</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">isInputFromTerminal</span><span class="p">:</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="nc">System</span><span class="p">.</span><span class="n">console</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span>
<span class="w">    </span><span class="nc">System</span><span class="p">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&quot;os.name&quot;</span><span class="p">).</span><span class="n">nn</span><span class="p">.</span><span class="n">toLowerCase</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&quot;windows&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">      </span><span class="n">sys</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">stdin</span><span class="p">.</span><span class="n">available</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>Verify that this works on Windows.</p>
</div>
</section>
<section id="allowing-the-user-to-edit-their-input">
<h3><span class="section-number">3.4.4. </span>Allowing the user to edit their input<a class="headerlink" href="#allowing-the-user-to-edit-their-input" title="Link to this heading"></a></h3>
<p>Many REPLs, including the Python and Scala ones, allow the user to edit their input in various ways, including scrolling through the input history using the up and down arrows, adding or deleting characters from the input line, etc.</p>
<p>To add this capability to a Java- or Scala-based command-line app, we can use the <a class="reference external" href="https://github.com/jline/jline3">JLine library</a>, which is the Java equivalent of the <a class="reference external" href="https://en.wikipedia.org/wiki/GNU_Readline">GNU Readline library</a>.
If you want to make your command-line app convenient to use and give it a professional touch, consider using JLine instead of basic console input.
JLine has excellent documentation; please look there for examples.</p>
<div class="admonition-todo admonition" id="id5">
<p class="admonition-title">Todo</p>
<p>Determine whether JLine automatically suppresses prompts when redirecting stdin.</p>
</div>
</section>
<section id="finding-good-third-party-libraries">
<h3><span class="section-number">3.4.5. </span>Finding good third-party libraries<a class="headerlink" href="#finding-good-third-party-libraries" title="Link to this heading"></a></h3>
<p>For most programming languages, platforms, and other ecosystems, there are lists of “awesome” libraries and tools.
For a particular language, search for “awesome” followed by the name of the language.</p>
<p>In Scala’s case, we would come across this here list:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/lauris/awesome-scala">https://github.com/lauris/awesome-scala</a></p>
</div></blockquote>
<p>Within it, we can then look for the desired concern or purpose, such as “command line interfaces”, where we find mainargs among several other choices.
It can be hard to choose a specific library;
some typical criteria are:</p>
<blockquote>
<div><ul class="simple">
<li><p>ease of use</p></li>
<li><p>quality of documentation</p></li>
<li><p>popularity</p></li>
<li><p>active development status</p></li>
<li><p>code quality</p></li>
<li><p>number of dependencies (lower is usually better)</p></li>
<li><p>security (absence of known vulnerabilities)</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="the-role-of-logging">
<h2><span class="section-number">3.5. </span>The role of logging<a class="headerlink" href="#the-role-of-logging" title="Link to this heading"></a></h2>
<p>Logging is a common dynamic nonfunctional requirement that is useful throughout the lifecycle of a system.
Logging can be challenging because it is a cross-cutting concern that arises throughout the codebase.</p>
<p>In its simplest form, logging can consist of ordinary print statements, preferably to the <em>standard error</em> stream (<code class="docutils literal notranslate"><span class="pre">stderr</span></code>):</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">System</span><span class="p">.</span><span class="n">err</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;something went wrong: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">anObject</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows displaying (or redirecting) error messages separately from output data.</p>
<p>For more complex projects, it is advantageous to be able to configure logging centrally, such as suppressing log messages below a certain <a class="reference external" href="https://stackoverflow.com/questions/2031163/when-to-use-the-different-log-levels">log level</a> indicating the severity of the message, configuring the destination of the log messages, or disabling logging altogether.</p>
<p><em>Logging frameworks</em> have arisen to address this need.
Modern logging frameworks have very low performance overhead and are a convenient and effective way to achieve professional-grade <a class="reference external" href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a> with respect to logging.</p>
<p>Proper logging is perhaps more important in applications where one doesn’t normally see the console output, such as apps with a graphical user interface and back-end server apps.
In those cases, logging allows ongoing monitoring of app progress, as well as error analysis if something isn’t working.</p>
<section id="logging-in-scala">
<h3><span class="section-number">3.5.1. </span>Logging in Scala<a class="headerlink" href="#logging-in-scala" title="Link to this heading"></a></h3>
<p>A popular choice found on the <a class="reference external" href="https://github.com/lauris/awesome-scala">Awesome Scala</a> list, the <a class="reference external" href="https://github.com/Log4s/log4s">log4s</a> wrapper provides a convenient logging mechanism for Scala.
To use log4s minimally, the following steps are required:</p>
<ul>
<li><p>Add external dependencies for log4s and a simple slf4j backend implementation:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;org.log4s&quot;</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="s">&quot;log4s&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.10.0&quot;</span><span class="p">,</span>
<span class="s">&quot;org.slf4j&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;slf4j-simple&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="s">&quot;1.7.30&quot;</span>
</pre></div>
</div>
</li>
<li><p>If you require a more verbose (lower severity) log level than the default of <code class="docutils literal notranslate"><span class="pre">INFO</span></code>, such as <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>, add a configuration file <code class="docutils literal notranslate"><span class="pre">src/main/resources/simplelogger.properties</span></code> with contents:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">org</span><span class="p">.</span><span class="n">slf4j</span><span class="p">.</span><span class="n">simpleLogger</span><span class="p">.</span><span class="n">defaultLogLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">debug</span>
</pre></div>
</div>
</li>
<li><p>Now you are ready to access and use your logger:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="k">import</span><span class="w"> </span><span class="nn">scala</span><span class="p">.</span><span class="nn">language</span><span class="p">.</span><span class="n">unsafeNulls</span>
<span class="w">  </span><span class="n">org</span><span class="p">.</span><span class="n">log4s</span><span class="p">.</span><span class="n">getLogger</span>
<span class="c1">// ...</span>
<span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">f&quot;howMany = </span><span class="si">$</span><span class="n">howMany</span><span class="s"> minLength = </span><span class="si">$</span><span class="n">minLength</span><span class="s"> lastNWords = </span><span class="si">$</span><span class="n">lastNWords</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces informative debugging output such as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>main<span class="o">]</span><span class="w"> </span>DEBUG<span class="w"> </span>edu.luc.cs.cs371.topwords.TopWords<span class="w"> </span>-<span class="w"> </span><span class="nv">howMany</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="nv">minLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="nv">lastNWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="the-importance-of-constant-space-complexity">
<span id="subsecconstantspace"></span><h2><span class="section-number">3.6. </span>The importance of constant-space complexity<a class="headerlink" href="#the-importance-of-constant-space-complexity" title="Link to this heading"></a></h2>
<p>Common application scenarios involve processing large volumes of input data or indefinite input streams, e.g., sensor data from an internet-of-things device.
To achieve the nonfunctional requirements of reliability/availability and scalability for such applications, it is critical to ensure that the application does not exceed a constant memory footprint during its execution.
<em>These considerations apply to any potentially long-running application, be it a command-line app, mobile app, or back-end service.</em></p>
<section id="using-iterators-to-represent-indefinite-input">
<h3><span class="section-number">3.6.1. </span>Using iterators to represent indefinite input<a class="headerlink" href="#using-iterators-to-represent-indefinite-input" title="Link to this heading"></a></h3>
<p>In these scenarios, it is common to process an indefinite number of input items, one at a time, as long as more items are available from the input.
Concretely, whenever possible, this means reading and processing one input item at a time and then forgetting about it, rather than first storing the entire input in memory and then processing it in bulk.
This version of a program that echoes back and counts its input lines has constant-space complexity:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">checkError</span><span class="p">()</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; lines counted&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>By contrast, this version has linear-space complexity and may run out of space on a large volume of input data:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="kd">val</span><span class="w"> </span><span class="n">listOfLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lines</span><span class="p">.</span><span class="n">toList</span>
<span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">listOfLines</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">checkError</span><span class="p">()</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; lines counted&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In sum, to achieve constant-space complexity, it is usually best to represent the input data as an iterator instead of converting it to an in-memory collection such as a list.
Iterators support most of the same behaviors as in-memory collections.</p>
</section>
<section id="monitoring-a-program-s-memory-footprint-over-time">
<h3><span class="section-number">3.6.2. </span>Monitoring a program’s memory footprint over time<a class="headerlink" href="#monitoring-a-program-s-memory-footprint-over-time" title="Link to this heading"></a></h3>
<p>To monitor a program’s memory footprint over time, we would typically use a heap profiler.
For programs running in the Java Virtual Machine (JVM), we can use the standalone version of VisualVM.</p>
<p>For example, the following heap profile (upper right section of the screenshot) shows a flat sawtooth pattern, suggesting constant space complexity even as we are processing more and more input items.
By contrast, if the sawtooth pattern were sloping upward over time, space complexity would increase as we are processing our input, suggesting some function that grows in terms of the input size n.</p>
<img alt="_images/heapprofile.png" src="_images/heapprofile.png" />
<p>When working in a command-line environment, we can also use an interactive process viewer, such as <code class="docutils literal notranslate"><span class="pre">htop</span></code>, to monitor a program’s memory footprint over time.</p>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>add suitable htop screenshot</p>
</div>
</section>
</section>
<section id="making-command-line-applications-testable">
<h2><span class="section-number">3.7. </span>Making command-line applications testable<a class="headerlink" href="#making-command-line-applications-testable" title="Link to this heading"></a></h2>
<p>Recognizing the importance of <em>testability</em> as a static nonfunctional requirement, we’d like to make our command-line applications testable.
While we could use other command-line tools to set up automatic testing of the end-to-end functionality of our applications, we would also like to unit-test the logical functionality of our applications in isolation from input/output code.</p>
<p>A key barrier to achieving this goal is the tangling (interweaving) of logical functionality and input/output in our code, i.e., there is a lack of separation of these two concerns.
In particular, how can we make our code testable <em>without</em> sacrificing the important dynamic nonfunctional requirement of a constant-space memory footprint?</p>
<p>The following example goes through several evolutions of a simple example to illustrate the design tradeoffs involved in reconciling these conflicting forces, using suitable software design patterns.</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/lucproglangcourse/consoleapp-java">https://github.com/lucproglangcourse/consoleapp-java</a></p>
</div></blockquote>
<p>Upon reflection, this journey also leads us away from simple, straight-line imperative or scripting code toward a more complex design involving custom abstractions.
The endpoint of this journey thereby marks our transition to the object-oriented paradigm.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="30-objectoriented.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">4. </span>The Object-Oriented Programming Paradigm</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="10-background.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">2. </span>Context and Background</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2017-Present, Konstantin Läufer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">3. The Imperative Programming Paradigm</a><ul>
<li><a class="reference internal" href="#core-elements">3.1. Core elements</a><ul>
<li><a class="reference internal" href="#named-mutable-state">3.1.1. Named Mutable State</a></li>
<li><a class="reference internal" href="#control-flow">3.1.2. Control Flow</a></li>
<li><a class="reference internal" href="#procedural-abstraction">3.1.3. Procedural Abstraction</a></li>
<li><a class="reference internal" href="#other-elements">3.1.4. Other Elements</a></li>
<li><a class="reference internal" href="#examples-across-languages">3.1.5. Examples Across Languages</a></li>
<li><a class="reference internal" href="#discussion">3.1.6. Discussion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#options-for-running-scala-code">3.2. Options for running Scala code</a></li>
<li><a class="reference internal" href="#techniques-for-testing-scala-code">3.3. Techniques for testing Scala code</a><ul>
<li><a class="reference internal" href="#measuring-code-coverage">3.3.1. Measuring code coverage</a></li>
<li><a class="reference internal" href="#end-to-end-application-testing">3.3.2. End-to-end application testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-role-of-command-line-applications">3.4. The role of command-line applications</a><ul>
<li><a class="reference internal" href="#command-line-applications-in-scala">3.4.1. Command-line applications in Scala</a></li>
<li><a class="reference internal" href="#command-line-argument-parsing">3.4.2. Command-line argument parsing</a></li>
<li><a class="reference internal" href="#determining-whether-an-app-is-running-interactively">3.4.3. Determining whether an app is running interactively</a></li>
<li><a class="reference internal" href="#allowing-the-user-to-edit-their-input">3.4.4. Allowing the user to edit their input</a></li>
<li><a class="reference internal" href="#finding-good-third-party-libraries">3.4.5. Finding good third-party libraries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-role-of-logging">3.5. The role of logging</a><ul>
<li><a class="reference internal" href="#logging-in-scala">3.5.1. Logging in Scala</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-importance-of-constant-space-complexity">3.6. The importance of constant-space complexity</a><ul>
<li><a class="reference internal" href="#using-iterators-to-represent-indefinite-input">3.6.1. Using iterators to represent indefinite input</a></li>
<li><a class="reference internal" href="#monitoring-a-program-s-memory-footprint-over-time">3.6.2. Monitoring a program’s memory footprint over time</a></li>
</ul>
</li>
<li><a class="reference internal" href="#making-command-line-applications-testable">3.7. Making command-line applications testable</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/documentation_options.js?v=64e26663"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>