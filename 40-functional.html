<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="6. Program Representation and Interpretation" href="50-representationinterpretation.html"><link rel="prev" title="4. The Object-Oriented Programming Paradigm" href="30-objectoriented.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.12.19 -->
        <title>5. The Functional Programming Paradigm - Loyola University Chicago COMP 371/471 Lecture Notes v26sp.4</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Loyola University Chicago COMP 371/471 Lecture Notes v26sp.4</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">Loyola University Chicago COMP 371/471 Lecture Notes v26sp.4</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="05-overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-background.html">2. Context and Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="20-imperative.html">3. The Imperative Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="30-objectoriented.html">4. The Object-Oriented Programming Paradigm</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">5. The Functional Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="50-representationinterpretation.html">6. Program Representation and Interpretation</a></li>
<li class="toctree-l1"><a class="reference internal" href="60-concurrency.html">7. The Concurrent Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="70-logic.html">8. The Logic Programming Paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="75-otherparadigms.html">9. Other Important Programming Paradigms</a></li>
<li class="toctree-l1"><a class="reference internal" href="78-summary.html">10. Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="80-principles.html">11. Appendix: Programming Language Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="83-resources.html">12. Appendix: Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="85-software.html">13. Appendix: Course Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="90-syllabus.html">14. Appendix: Course Syllabi</a></li>
<li class="toctree-l1"><a class="reference internal" href="95-todo.html">15. Appendix: TODO</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/40-functional.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="the-functional-programming-paradigm">
<h1><span class="section-number">5. </span>The Functional Programming Paradigm<a class="headerlink" href="#the-functional-programming-paradigm" title="Link to this heading"></a></h1>
<p>In this chapter, we study the functional programming paradigm, with examples and projects mostly in Scala.</p>
<section id="core-elements">
<h2><span class="section-number">5.1. </span>Core Elements<a class="headerlink" href="#core-elements" title="Link to this heading"></a></h2>
<p>The functional paradigm is characterized by <strong>computation as the evaluation of functions</strong>.
Functions are <em>first-class citizens</em>, programs are expressed declaratively, and emphasis
is placed on immutability and avoidance of side effects.</p>
<section id="expression-oriented-computation">
<h3><span class="section-number">5.1.1. </span>Expression-Oriented Computation<a class="headerlink" href="#expression-oriented-computation" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Programs are built from expressions that yield values.</p></li>
<li><p>No distinction between statements and expressions in purely functional languages.</p></li>
</ul>
</section>
<section id="immutability">
<h3><span class="section-number">5.1.2. </span>Immutability<a class="headerlink" href="#immutability" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Variables are bound once and cannot be reassigned.</p></li>
<li><p>Encourages referential transparency: expressions can be replaced with their values without changing program meaning.</p></li>
</ul>
</section>
<section id="first-class-and-higher-order-functions">
<h3><span class="section-number">5.1.3. </span>First-Class and Higher-Order Functions<a class="headerlink" href="#first-class-and-higher-order-functions" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Functions as first-class values</strong>: can be passed as arguments, returned as results, and stored in data structures.</p></li>
<li><p><strong>Higher-order functions</strong>: functions that take other functions as parameters or return them.</p></li>
<li><p><strong>Lambdas</strong>: functions can be created on-the-fly and capture their lexical environment (<strong>closures</strong>).</p></li>
</ul>
</section>
<section id="recursion">
<h3><span class="section-number">5.1.4. </span>Recursion<a class="headerlink" href="#recursion" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Primary mechanism for repetition.</p></li>
<li><p>Loops are replaced by recursive definitions.</p></li>
</ul>
</section>
<section id="pattern-matching">
<h3><span class="section-number">5.1.5. </span>Pattern Matching<a class="headerlink" href="#pattern-matching" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Provides a declarative way to deconstruct data structures and control flow.</p></li>
<li><p>Enables concise handling of algebraic data types.</p></li>
</ul>
</section>
<section id="lazy-evaluation">
<h3><span class="section-number">5.1.6. </span>Lazy Evaluation<a class="headerlink" href="#lazy-evaluation" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Expressions evaluated only when needed (default in Haskell).</p></li>
<li><p>Can improve modularity and performance.</p></li>
</ul>
</section>
<section id="other-elements">
<h3><span class="section-number">5.1.7. </span>Other Elements<a class="headerlink" href="#other-elements" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Type inference</strong>: deduce function and variable types automatically (e.g., Haskell, Scala).</p></li>
<li><p><strong>Purity</strong>: avoiding side effects; I/O and state modeled explicitly (monads, uniqueness types).</p></li>
</ul>
</section>
<section id="examples-across-languages">
<h3><span class="section-number">5.1.8. </span>Examples Across Languages<a class="headerlink" href="#examples-across-languages" title="Link to this heading"></a></h3>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Element</p></th>
<th class="head"><p>Java</p></th>
<th class="head"><p>Scala</p></th>
<th class="head"><p>Haskell</p></th>
<th class="head"><p>Scheme</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>First-class function</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Function&lt;Integer,Integer&gt;</span> <span class="pre">f</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">x+1;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">f</span> <span class="pre">=</span> <span class="pre">(x:Int)</span> <span class="pre">=&gt;</span> <span class="pre">x+1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">x+1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(define</span> <span class="pre">f</span> <span class="pre">(lambda</span> <span class="pre">(x)</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">1)))</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Higher-order function</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list.stream().map(x</span> <span class="pre">-&gt;</span> <span class="pre">x+1)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">List(1,2,3).map(_+1)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">map</span> <span class="pre">(+1)</span> <span class="pre">[1,2,3]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(map</span> <span class="pre">(lambda</span> <span class="pre">(x)</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">1))</span> <span class="pre">'(1</span> <span class="pre">2</span> <span class="pre">3))</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Immutability</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">final</span> <span class="pre">var</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">5;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">5</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">5</span> <span class="pre">in</span> <span class="pre">...</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(define</span> <span class="pre">y</span> <span class="pre">5)</span></code> (by convention immutable)</p></td>
</tr>
<tr class="row-odd"><td><p>Recursion</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">fact(int</span> <span class="pre">n){</span> <span class="pre">return</span> <span class="pre">n==0?1:n*fact(n-1);</span> <span class="pre">}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">fact(n:Int):Int</span> <span class="pre">=</span> <span class="pre">if</span> <span class="pre">(n==0)</span> <span class="pre">1</span> <span class="pre">else</span> <span class="pre">n*fact(n-1)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fact</span> <span class="pre">0</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">fact</span> <span class="pre">n</span> <span class="pre">=</span> <span class="pre">n*fact(n-1)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(define</span> <span class="pre">(fact</span> <span class="pre">n)</span> <span class="pre">(if</span> <span class="pre">(=</span> <span class="pre">n</span> <span class="pre">0)</span> <span class="pre">1</span> <span class="pre">(*</span> <span class="pre">n</span> <span class="pre">(fact</span> <span class="pre">(-</span> <span class="pre">n</span> <span class="pre">1)))))</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Pattern matching</p></td>
<td><p>Not built-in</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">match</span> <span class="pre">{</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">=&gt;</span> <span class="pre">1;</span> <span class="pre">case</span> <span class="pre">n</span> <span class="pre">=&gt;</span> <span class="pre">n*fact(n-1)</span> <span class="pre">}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">fact</span> <span class="pre">0</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">fact</span> <span class="pre">n</span> <span class="pre">=</span> <span class="pre">n*fact</span> <span class="pre">(n-1)</span></code></p></td>
<td><p>Not built-in (simulate with cond)</p></td>
</tr>
<tr class="row-odd"><td><p>Lazy evaluation</p></td>
<td><p>Streams (<code class="docutils literal notranslate"><span class="pre">Stream.of(1,2,3)</span></code>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LazyList.from(1)</span></code></p></td>
<td><p>Default in Haskell</p></td>
<td><p>Not default; can simulate with thunks</p></td>
</tr>
<tr class="row-even"><td><p>Closure</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Function&lt;Integer,Integer&gt;</span> <span class="pre">f</span> <span class="pre">=</span> <span class="pre">(x)</span> <span class="pre">-&gt;</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">f</span> <span class="pre">=</span> <span class="pre">(x:Int)</span> <span class="pre">=&gt;</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">\x</span> <span class="pre">-&gt;</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(define</span> <span class="pre">f</span> <span class="pre">(lambda</span> <span class="pre">(x)</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">y)))</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="discussion">
<h3><span class="section-number">5.1.9. </span>Discussion<a class="headerlink" href="#discussion" title="Link to this heading"></a></h3>
<p>Functional programming emphasizes <em>declarative expression of computation</em>
rather than step-by-step instructions.
It enables equational reasoning, parallelization, and safer abstractions by
reducing reliance on mutable state.</p>
<p>Modern multiparadigm languages (Scala, Python, Java 8+) integrate functional
features, while classic functional languages like Scheme, Haskell, and ML
highlight the paradigm in its purest form.</p>
</section>
</section>
<section id="solving-problems-using-built-in-types-and-behaviors">
<h2><span class="section-number">5.2. </span>Solving problems using built-in types and behaviors<a class="headerlink" href="#solving-problems-using-built-in-types-and-behaviors" title="Link to this heading"></a></h2>
<p>In this section, we’ll first return to the scripting style for a bit but with a functional touch, which encourages the use of immutable references and data structures.
Arguably, this makes it easier to understand program behavior, especially in the presence of concurrency, defined as more than one activity (task, thread, or process) going on at the same time.</p>
<p>As do other languages, Scala provides an extensive library of predefined types and (generic) type constructors along with a rich set of behaviors.
Many of these, especially collection types and certain utility types, are <em>algebraic data types</em>, discussed below in more detail:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Seq</span></code> / <code class="docutils literal notranslate"><span class="pre">List</span></code></p>
<ul>
<li><p><a class="reference external" href="https://www.scala-lang.org/api/current/scala/collection/Seq.html">https://www.scala-lang.org/api/current/scala/collection/Seq.html</a></p></li>
<li><p><a class="reference external" href="https://www.scala-lang.org/api/current/scala/collection/immutable/List.html">https://www.scala-lang.org/api/current/scala/collection/immutable/List.html</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/lists.sc">https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/lists.sc</a></p></li>
<li><p>note the difference between those and tuples</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Map</span></code></p>
<ul>
<li><p><a class="reference external" href="https://www.scala-lang.org/api/current/scala/collection/Map.html">https://www.scala-lang.org/api/current/scala/collection/Map.html</a></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Option</span></code> / <code class="docutils literal notranslate"><span class="pre">Either</span></code></p>
<ul>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/option.sc">https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/option.sc</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/either.sc">https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/either.sc</a></p></li>
<li><p><a class="reference external" href="http://robsscala.blogspot.com/2012/06/fixing-scalaeither-unbiased-vs-biased.html">http://robsscala.blogspot.com/2012/06/fixing-scalaeither-unbiased-vs-biased.html</a></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Try</span></code></p>
<ul>
<li><p><a class="reference external" href="https://www.scala-lang.org/api/current/scala/util/Try.html">https://www.scala-lang.org/api/current/scala/util/Try.html</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/try.sc">https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/try.sc</a></p></li>
</ul>
</li>
</ul>
<p>By using Scala like a scripting language (such as Python or Ruby), one can solve many problems without even defining custom algebraic data types, except perhaps the occasional tuple, a lightweight aggregation of heterogeneous types based on the Cartesian product.
The main building blocks in scripting-style Scala are the collection and utility types we just mentioned, along with these behaviors:</p>
<ul class="simple">
<li><p>important methods <code class="docutils literal notranslate"><span class="pre">map</span></code>, <code class="docutils literal notranslate"><span class="pre">take</span></code> / <code class="docutils literal notranslate"><span class="pre">drop</span></code>, <code class="docutils literal notranslate"><span class="pre">filter</span></code> / <code class="docutils literal notranslate"><span class="pre">withFilter</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span></code>, <code class="docutils literal notranslate"><span class="pre">flatMap</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">foldLeft</span></code> / <code class="docutils literal notranslate"><span class="pre">foldRight</span></code>, <code class="docutils literal notranslate"><span class="pre">scanLeft</span></code>, <code class="docutils literal notranslate"><span class="pre">zip</span></code>, <code class="docutils literal notranslate"><span class="pre">groupBy</span></code>, <code class="docutils literal notranslate"><span class="pre">collect</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span></code> comprehensions</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Elaborate more on <code class="docutils literal notranslate"><span class="pre">for</span></code> comprehensions and <code class="docutils literal notranslate"><span class="pre">flatMap</span></code></p>
</div>
<section id="examples">
<h3><span class="section-number">5.2.1. </span>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<p>We recall this example of looping over all items in a finite collection or iterator using mutable state:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<span class="kd">var</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="n">incoming</span><span class="p">.</span><span class="na">forEachRemaining</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">length</span><span class="p">();</span>
<span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">});</span>

<span class="kd">final</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
</pre></div>
</div>
<p><em>What does this code compute?</em></p>
<p>In Scala, we can use an <em>immutable</em> equivalent using <code class="docutils literal notranslate"><span class="pre">foldLeft</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">incoming</span><span class="p">.</span><span class="n">foldLeft</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="p">((</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">),</span><span class="w"> </span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="p">(</span><span class="n">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">next</span><span class="p">.</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">.</span><span class="n">toFloat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">count</span>
</pre></div>
</div>
<p>As noted previously, you cannot “un-fuse” this loop equivalent because the iterator is stateful and you can iterate through it only once.
On the other hand, if <code class="docutils literal notranslate"><span class="pre">incoming</span></code> is a collection (always finite) instead of an iterator (potentially unbounded), you can use <code class="docutils literal notranslate"><span class="pre">map</span></code> and <code class="docutils literal notranslate"><span class="pre">sum</span></code>, a specialized fold, for a terser equivalent:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">incoming</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">length</span><span class="p">).</span><span class="n">sum</span>
<span class="kd">val</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">incoming</span><span class="p">.</span><span class="n">size</span>
<span class="kd">val</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">.</span><span class="n">toFloat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">count</span>
</pre></div>
</div>
<p>This is equivalent to two consecutive loops, one for <code class="docutils literal notranslate"><span class="pre">map</span></code> and one for <code class="docutils literal notranslate"><span class="pre">sum</span></code>.</p>
<p>It is also common to have unbounded loops until a condition is met, e.g., reading lines from standard input until end-of-file (EOF):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;enter next expression: &quot;</span><span class="p">);</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">hasNextLine</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="na">nextLine</span><span class="p">();</span>
<span class="w">  </span><span class="n">processExpr</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;enter next expression: &quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In Scala, we can use an <em>immutable</em> equivalent using <code class="docutils literal notranslate"><span class="pre">Iterator</span></code> with <code class="docutils literal notranslate"><span class="pre">continually</span></code> and <code class="docutils literal notranslate"><span class="pre">takeWhile</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">Iterator</span><span class="w"> </span><span class="n">continually</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;enter next expression: &quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nc">StdIn</span><span class="p">.</span><span class="n">readLine</span><span class="p">()</span>
<span class="p">}</span><span class="w"> </span><span class="n">takeWhile</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="n">line</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span><span class="w"> </span><span class="n">foreach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="n">processExpr</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="other-important-operations-on-collections">
<h3><span class="section-number">5.2.2. </span>Other important operations on collections<a class="headerlink" href="#other-important-operations-on-collections" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>When the body of the iteration produces a <em>side effect</em> such as output, we can use <code class="docutils literal notranslate"><span class="pre">foreach</span></code> instead of <code class="docutils literal notranslate"><span class="pre">continually</span></code>.</p></li>
<li><p>If we want to compute a <em>result value</em>, we can use <code class="docutils literal notranslate"><span class="pre">foldLeft</span></code> instead of <code class="docutils literal notranslate"><span class="pre">foreach</span></code>.</p></li>
<li><p>If we want to compute a <em>sequence of result values</em>, one for each original item, we can use <code class="docutils literal notranslate"><span class="pre">scanLeft</span></code> (examples are available <a class="reference external" href="https://github.com/lucproglangcourse/iterators-scala">here</a>).</p></li>
<li><p>If we want to transform a <em>collection of result values</em> by independently applying the same function to each item while preserving the collection’s skeletal structure, we can use <code class="docutils literal notranslate"><span class="pre">map</span></code>.</p></li>
<li><p>If we want to do the same as <code class="docutils literal notranslate"><span class="pre">map</span></code> but without introducing an additional level of structural nesting even though the function does so, we can use <code class="docutils literal notranslate"><span class="pre">flatMap</span></code>, which flattens the inner structure into the outer; an example is the splitting of lines to words seen in the section on console applications. <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">map</span></code> followed by <code class="docutils literal notranslate"><span class="pre">flatten</span></code>.</p></li>
</ul>
<p>The following example illustrates the difference between <code class="docutils literal notranslate"><span class="pre">map</span></code> and <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> from an imperative perspective:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="c1">// map - the result is a nested collection</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">Seq</span><span class="p">(</span><span class="s">&quot;hello world what up&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hola mundo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hallo welt&quot;</span><span class="p">)</span>
<span class="n">res0</span><span class="p">:</span><span class="w"> </span><span class="nc">Seq</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span><span class="n">hello</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="n">hola</span><span class="w"> </span><span class="n">mundo</span><span class="p">,</span><span class="w"> </span><span class="n">hallo</span><span class="w"> </span><span class="n">welt</span><span class="p">)</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res0</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\\s+&quot;</span><span class="p">))</span>
<span class="kd">val</span><span class="w"> </span><span class="n">res1</span><span class="p">:</span><span class="w"> </span><span class="nc">Seq</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">),</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">hola</span><span class="p">,</span><span class="w"> </span><span class="n">mundo</span><span class="p">),</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">hallo</span><span class="p">,</span><span class="w"> </span><span class="n">welt</span><span class="p">))</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">resultNested</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">collection</span><span class="p">.</span><span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">.</span><span class="n">empty</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span>
<span class="n">resultNested</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">collection</span><span class="p">.</span><span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ArrayBuffer</span><span class="p">()</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res0</span><span class="p">.</span><span class="n">foreach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="kd">val</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\\s+&quot;</span><span class="p">)</span>
<span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="n">resultNested</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">words</span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="p">}</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultNested</span>
<span class="n">res2</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">collection</span><span class="p">.</span><span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">[</span><span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ArrayBuffer</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">),</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">hola</span><span class="p">,</span><span class="w"> </span><span class="n">mundo</span><span class="p">),</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">hallo</span><span class="p">,</span><span class="w"> </span><span class="n">welt</span><span class="p">))</span>

<span class="c1">// flatMap - the result is a flat collection - this requires nested loops!</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res0</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\\s+&quot;</span><span class="p">))</span>
<span class="kd">val</span><span class="w"> </span><span class="n">res3</span><span class="p">:</span><span class="w"> </span><span class="nc">Seq</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="n">hola</span><span class="p">,</span><span class="w"> </span><span class="n">mundo</span><span class="p">,</span><span class="w"> </span><span class="n">hallo</span><span class="p">,</span><span class="w"> </span><span class="n">welt</span><span class="p">)</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="n">resultFlat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">collection</span><span class="p">.</span><span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">.</span><span class="n">empty</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span>
<span class="n">resultFlat</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">collection</span><span class="p">.</span><span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ArrayBuffer</span><span class="p">()</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res0</span><span class="p">.</span><span class="n">foreach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="kd">val</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;\\s+&quot;</span><span class="p">)</span>
<span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="n">words</span><span class="p">.</span><span class="n">foreach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">     </span><span class="o">|</span><span class="w">     </span><span class="n">resultFlat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">word</span>
<span class="w">     </span><span class="o">|</span><span class="w">   </span><span class="p">}</span>
<span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="p">}</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resultFlat</span>
<span class="n">res4</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">collection</span><span class="p">.</span><span class="n">mutable</span><span class="p">.</span><span class="nc">ArrayBuffer</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ArrayBuffer</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="p">,</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="n">hola</span><span class="p">,</span><span class="w"> </span><span class="n">mundo</span><span class="p">,</span><span class="w"> </span><span class="n">hallo</span><span class="p">,</span><span class="w"> </span><span class="n">welt</span><span class="p">)</span>
</pre></div>
</div>
<p>Note also that all of these are methods but look like control structures because of Scala’s syntax, which allows you to omit the dot in certain cases of method selection and to use curly braces instead of round parentheses to delimit your argument list.</p>
</section>
<section id="dealing-with-successive-failures">
<h3><span class="section-number">5.2.3. </span>Dealing with successive failures<a class="headerlink" href="#dealing-with-successive-failures" title="Link to this heading"></a></h3>
<p>Trying successive choices until either one succeeds or there is none left and we have to give up.
Nested <code class="docutils literal notranslate"><span class="pre">try</span></code>-<code class="docutils literal notranslate"><span class="pre">catch</span></code> statements are often used to achieve this:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">AuthorizeRequestStrategy</span><span class="w"> </span><span class="n">authorizeRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;looking for access token&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;found access token&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">authorizeRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">addHttpHeaders</span><span class="p">(</span><span class="n">authHeader</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;looking for API key in environment&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">apiKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="na">env</span><span class="p">(</span><span class="s">&quot;API_KEY&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;found API key&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">authorizeRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">addQueryStringParameter</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">apiKey</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">NoSuchElementException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">logger</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;no authorization information found, exiting&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">401</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Immutable equivalent using successive <code class="docutils literal notranslate"><span class="pre">Try</span></code> blocks, flat-chained using <code class="docutils literal notranslate"><span class="pre">orElse</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">authorizeRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Try</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;looking for access token in property file&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="p">...</span>
<span class="w">   </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;found access token&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="kd">val</span><span class="w"> </span><span class="n">authHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">KeyAuthorization</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">s&quot;Bearer </span><span class="si">$</span><span class="n">accessToken</span><span class="s">&quot;</span>
<span class="w">   </span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="nc">WSRequest</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">addHttpHeaders</span><span class="p">(</span><span class="n">authHeader</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">orElse</span><span class="w"> </span><span class="nc">Try</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;looking for API key in environment&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="kd">val</span><span class="w"> </span><span class="n">apiKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">env</span><span class="p">(</span><span class="s">&quot;API_KEY&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;found API key&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="nc">WSRequest</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">addQueryStringParameters</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">apiKey</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">getOrElse</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;no authorization information found, exiting&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="n">sys</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>The more familiar one becomes with the various predefined building blocks, the more quickly and productively one can put together at least an initial solution to a problem.
Earlier versions of the <a class="reference external" href="https://github.com/lucproglangcourse/processtree-scala">process tree</a> example illustrates this style, while later versions reflect greater emphasis on code quality, especially testability and avoidance of code duplication.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p><code class="docutils literal notranslate"><span class="pre">for</span></code> with blocks for embedding stateful steps such as logging</p>
</div>
</section>
<section id="challenges">
<h3><span class="section-number">5.2.4. </span>Challenges<a class="headerlink" href="#challenges" title="Link to this heading"></a></h3>
<p>Can we write (efficiently or not)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">reverse</span></code>, <code class="docutils literal notranslate"><span class="pre">filter</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span></code>, <code class="docutils literal notranslate"><span class="pre">map</span></code> as a fold, i.e., <code class="docutils literal notranslate"><span class="pre">foldLeft</span></code> or <code class="docutils literal notranslate"><span class="pre">foldRight</span></code>?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">foldLeft</span></code> or <code class="docutils literal notranslate"><span class="pre">foldRight</span></code> as <code class="docutils literal notranslate"><span class="pre">map</span></code>?!?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reverse</span></code> or <code class="docutils literal notranslate"><span class="pre">filter</span></code> as a <code class="docutils literal notranslate"><span class="pre">map</span></code>?</p></li>
</ul>
<p>Some hints:</p>
<ul class="simple">
<li><p>Look carefully at the respective domains and codomains (argument and result types). Can they fit?</p></li>
<li><p>Which is more general, <code class="docutils literal notranslate"><span class="pre">map</span></code> or <code class="docutils literal notranslate"><span class="pre">fold</span></code>?</p></li>
</ul>
</section>
<section id="modularity-and-dependency-injection-in-the-functional-style">
<h3><span class="section-number">5.2.5. </span>Modularity and dependency injection in the functional style<a class="headerlink" href="#modularity-and-dependency-injection-in-the-functional-style" title="Link to this heading"></a></h3>
<p>In the functional programming paradigm, first-class functions, i.e., the ability to pass functions as argument values to other functions, methods, and constructors, provides an alternative modular composition mechanism to the object-oriented ones discussed previously.</p>
<p>The <a class="reference external" href="https://github.com/lucproglangcourse/iterators-scala">iterators example</a> illustrates functional modularity in its <code class="docutils literal notranslate"><span class="pre">functional/modular</span></code> package.</p>
</section>
</section>
<section id="defining-algebraic-data-types">
<h2><span class="section-number">5.3. </span>Defining algebraic data types<a class="headerlink" href="#defining-algebraic-data-types" title="Link to this heading"></a></h2>
<p>Most structures fall into one of these categories:</p>
<ul class="simple">
<li><p>nonrecursive/scalars: boolean, finite enumerations (including numeric types), try</p></li>
<li><p>sublinear structures: (infinite set of) natural numbers, option</p></li>
<li><p>linear structures: lists, maps</p></li>
<li><p>nonlinear structures: trees, graphs, many custom domain models</p></li>
</ul>
<p>The fundamental building blocks of these <em>algebraic data types</em> are
related to those discussed in <a class="reference internal" href="30-objectoriented.html#secdomainmodelsoo"><span class="std std-ref">Defining domain models in object-oriented languages</span></a>:</p>
<ul class="simple">
<li><p>(disjoint) sum: variation</p></li>
<li><p>product (tuple, record) of a given arity: aggregation</p></li>
<li><p>recursion (at the type level)</p></li>
<li><p>type parameters (genericity)</p></li>
</ul>
<p>Using these building blocks, we can express the <cite>Shape</cite> domain model from the examples above as an algebraic data type:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">Shape</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Circle</span><span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="kt">Rectangle</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="kt">Group</span><span class="p">(</span><span class="kt">Seq</span><span class="p">(</span><span class="kt">Shape</span><span class="p">))</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="kt">Location</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="kt">Shape</span><span class="p">)</span>
</pre></div>
</div>
<p>We can separately define behaviors on Shapes as functions. Here is an example that illustrates this approach:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/shapes-oo-scala">https://github.com/lucproglangcourse/shapes-oo-scala</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/expressions-scala">https://github.com/lucproglangcourse/expressions-scala</a></p></li>
</ul>
<p>We identify the following structural and behavioral concerns:</p>
<ul class="simple">
<li><p>structure</p></li>
<li><p>content</p></li>
<li><p>traversal</p></li>
<li><p>processing</p></li>
</ul>
<p>So far, structure and content are combined within the definition of an algebraic data type, while traversal and processing are combined within the definition of a behavior on that algebraic data type.</p>
<section id="separation-of-structural-concerns">
<h3><span class="section-number">5.3.1. </span>Separation of structural concerns<a class="headerlink" href="#separation-of-structural-concerns" title="Link to this heading"></a></h3>
<p>We can, however, achieve a separation between structure and content with the help of <em>parametric polymorphism</em>, that is, making the algebraic data type <em>generic</em> in terms of the content.
The predefined collections are an example of this separation, as well as the <a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/orgchartGeneric.sc">generic org chart</a> example.</p>
</section>
</section>
<section id="behaviors-on-algebraic-data-types">
<h2><span class="section-number">5.4. </span>Behaviors on algebraic data types<a class="headerlink" href="#behaviors-on-algebraic-data-types" title="Link to this heading"></a></h2>
<p>The following are additional examples of behaviors on algebraic data types.
As expected, for recursive types, the behaviors are typically recursive as well.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/orgchart.sc">simple org charts</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/orgchartGeneric.sc">generic org charts</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/nat.sc">simple natural numbers</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/expressions-scala">expressions-scala</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/shapes-oo-scala">shapes-oo-scala</a></p></li>
</ul>
<p>In these examples, the traversal and processing concerns identified above remain combined.</p>
<section id="behaviors-based-on-recursive-thinking">
<h3><span class="section-number">5.4.1. </span>Behaviors based on recursive thinking<a class="headerlink" href="#behaviors-based-on-recursive-thinking" title="Link to this heading"></a></h3>
<p>To understand recursive thinking, let us explore the familiar <a class="reference external" href="https://github.com/lucproglangcourse/shapes-oo-scala">shapes example</a>.
We’ll start with a suitable algebraic type definition and some sample instances:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span><span class="w"> </span><span class="nc">Shape</span><span class="p">:</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Location</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="p">:</span><span class="w"> </span><span class="nc">Shape</span><span class="p">)</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Group</span><span class="p">(</span><span class="n">shapes</span><span class="p">:</span><span class="w"> </span><span class="nc">Shape</span><span class="o">*</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Rectangle</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Rectangle</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span>
<span class="kd">val</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Rectangle</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Group</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="nc">Group</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="nc">Location</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">))</span>
</pre></div>
</div>
<p>Let’s now try to implement a <code class="docutils literal notranslate"><span class="pre">countGroup</span></code> behavior.
This is incomplete but should compile;
<code class="docutils literal notranslate"><span class="pre">???</span></code> is a convenient placeholder for “not yet implemented” (NYI).</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">countGroup</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="nc">Shape</span><span class="p">):</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">match</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Rectangle</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Location</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">???</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Group</span><span class="p">(</span><span class="n">shapes</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">???</span>
</pre></div>
</div>
<p>As expected, <code class="docutils literal notranslate"><span class="pre">countGroup</span></code> returns 0 for rectangles but would raise a <code class="docutils literal notranslate"><span class="pre">NYI</span></code> exception for group or location nodes.</p>
<p>Now we need to apply recursive thinking:</p>
<ul class="simple">
<li><p>For location, the child might have group nodes.</p></li>
<li><p>For group, the current node is a group node, plus the children might have group nodes.</p></li>
</ul>
<p>Accordingly:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">countGroup</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="nc">Shape</span><span class="p">):</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">match</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Rectangle</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Location</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">countGroup</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nc">Group</span><span class="p">(</span><span class="n">shapes</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">shapes</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">countGroup</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="w">    </span><span class="n">sum</span>
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">countGroup(g)</span></code> returns 2 as expected, though this is a Java-style, imperative implementation.
Equivalently, we can use the <code class="docutils literal notranslate"><span class="pre">foreach</span></code> method instead of the so-called for comprehension:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="nc">Group</span><span class="p">(</span><span class="n">shapes</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">shapes</span><span class="p">.</span><span class="n">foreach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">    </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">countGroup</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">sum</span>
</pre></div>
</div>
<p>Now…drum roll…we have an opportunity to convert this code into functional, applicative, immutable style:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="nc">Group</span><span class="p">(</span><span class="n">shapes</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">shapes</span><span class="p">.</span><span class="n">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">countGroup</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">.</span><span class="n">sum</span>
</pre></div>
</div>
<p>where map transforms each item in a collection with the result of applying the given function to the item and sum adds all the items in a collection.</p>
<p>Some points to think about:</p>
<ul class="simple">
<li><p>Which design pattern describes the function we pass to the <code class="docutils literal notranslate"><span class="pre">map</span></code> method?</p></li>
<li><p>How would you compare these three implementations in terms of whatever functional and/or nonfunctional criteria you can think of?</p></li>
</ul>
</section>
<section id="separation-of-behavioral-concerns">
<h3><span class="section-number">5.4.2. </span>Separation of behavioral concerns<a class="headerlink" href="#separation-of-behavioral-concerns" title="Link to this heading"></a></h3>
<p>A question that comes to mind is whether they can be separated, similarly to the predefined higher-order methods on collections, such as <code class="docutils literal notranslate"><span class="pre">foldLeft</span></code>, <code class="docutils literal notranslate"><span class="pre">foldRight</span></code>, <code class="docutils literal notranslate"><span class="pre">map</span></code>, etc.
These methods go a step further than the Visitor pattern or our equivalent recursive behaviors:
They handle the <em>traversal</em> concern for us and separate it from the <em>processing</em> concern, which we handle by providing a suitable argument function.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/functionsOnLists.sc">functions on lists (reverse)</a></p></li>
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/functionsOnStreams.sc">functions on streams (potentially infinite lists with memoization)</a></p></li>
</ul>
<p>This question has a two-part answer:
Yes, we can define custom implementations of such higher-order behaviors for our own algebraic data types.
In addition, and this is where it gets really interesting, we can have a single, universal implementation that works for all algebraic data types where the children of any node are either fixed in number or stored in a collection that has a <code class="docutils literal notranslate"><span class="pre">map</span></code> method.</p>
<p>Another, seemingly esoteric, question is whether we can pull out recursion itself as a functional pattern.
Yes, we can.
In <a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/factorial.sc">this factorial example</a>,
the <code class="docutils literal notranslate"><span class="pre">Y</span></code>-combinator handles the <em>recursion</em> concern <em>for behaviors</em> and separates it from the concern of what should happen in each step of the recursion.</p>
<p>We will soon study the equivalent idea at the type level.</p>
</section>
</section>
<section id="a-closer-look-at-predefined-behaviors-on-lists">
<h2><span class="section-number">5.5. </span>A closer look at predefined behaviors on lists<a class="headerlink" href="#a-closer-look-at-predefined-behaviors-on-lists" title="Link to this heading"></a></h2>
<p>In this section, we take a look “under the hood” of some key predefined behaviors on lists.</p>
<p>In terms of performance, we must keep in mind that <a class="reference external" href="http://www.scala-lang.org/api/current/scala/collection/immutable/List.html">lists are head/tail-optimized</a>.
In other words, these are basically singly-linked lists, so any behaviors where we access the first node of the list are constant-time, while behaviors involving nodes further down in the list are linear-time.
In practice, acceptable performance usually means linear time for behavior where we process the entire list.</p>
<p>In addition, we need to be aware of <em>space complexity</em>.
Clearly, we are already using space for the arguments we are about to pass to the behavior and are willing to dedicate space to the result we are getting back, so the focus is on <em>additional</em> temporary space on the stack, which we like to keep constant if possible.
(This discussion is closely related to <a class="reference internal" href="20-imperative.html#subsecconstantspace"><span class="std std-ref">The importance of constant-space complexity</span></a>, where the assumption is that the arguments and the result are stored <em>externally</em>.)</p>
<p><em>Tail recursion</em>, where the very last step in a method or function body is the recursive invocation of the method itself, is an effective technique for achieving constant-space complexity as long the behavior can be expressed in a tail-recursive way.
In some cases, we can rewrite an implementation in a tail-recursive way by introducing an <em>accumulator</em> argument, where we essentially build up the result in the accumulator and then return that result once we reach the base case of the recursion.
A tail-recursive implementation can easily be transformed to a <code class="docutils literal notranslate"><span class="pre">while</span></code> loop by introducing a mutable variable to represent the progress into the list structure.
This <a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/functionsOnLists.sc">reverse example</a> illustrates these concepts and techniques in more detail.</p>
<p>Here are some observations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">foldLeft</span></code> is usually what we want: <em>linear-time</em> and <em>constant-space</em> (naturally tail-recursive).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">foldRight</span></code> is <em>linear-time</em> and <em>linear-space</em> (<em>not</em> tail-recursive) but goes with the natural head-tail structure of the list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xs.foldRight(z)(f)</span> <span class="pre">==</span> <span class="pre">xs.reverse.foldLeft(z)(g)</span></code> where <code class="docutils literal notranslate"><span class="pre">g</span></code> is <code class="docutils literal notranslate"><span class="pre">f</span></code> with the arguments switched.</p></li>
</ul>
<p>To look at the actual Scala library implementations of these functions, first find desired method in the API documentation, expand, look for <em>definition classes</em>, follow the link to the leftmost definition class, then the link to that class’s Scala source, and finally look for the actual method.
For performance reasons, these professional implementations tend to appear more complex than we might expect.
Here are some examples:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/scala/scala/blob/v2.12.4/src/library/scala/collection/immutable/List.scala#L375">foreach</a></p></li>
<li><p><a class="reference external" href="https://github.com/scala/scala/blob/v2.12.4/src/library/scala/collection/LinearSeqOptimized.scala#L118">foldLeft</a></p></li>
<li><p><a class="reference external" href="https://github.com/scala/scala/blob/v2.12.4/src/library/scala/collection/immutable/List.scala#L383">reverse</a></p></li>
<li><p><a class="reference external" href="https://github.com/scala/scala/blob/v2.12.4/src/library/scala/collection/immutable/List.scala#L393">foldRight</a></p></li>
<li><p><a class="reference external" href="https://github.com/scala/scala/blob/v2.12.4/src/library/scala/collection/immutable/List.scala#L269">map</a></p></li>
<li><p><a class="reference external" href="https://github.com/scala/scala/blob/v2.12.4/src/library/scala/collection/LinearSeqOptimized.scala#L47">length</a></p></li>
</ul>
<p>For more details on space complexity and tail recursion, please take a look at these references:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://kartikiyer.com/2020/08/04/tail-recursion-in-scala">Tail Recursion in Scala</a></p></li>
<li><p><a class="reference external" href="https://john.cs.olemiss.edu/~hcc/csci555/notes/RecursionStyles/RecursionStylesScala.html">Functional Programming Recursion Styles, Correctness, and Efficiency</a></p></li>
<li><p><a class="reference external" href="http://blog.richdougherty.com/2009/04/tail-calls-tailrec-and-trampolines.html">tail recursion, trampolines, and continuations</a> (advanced)</p></li>
</ul>
</section>
<section id="separation-of-concerns-at-the-type-level">
<h2><span class="section-number">5.6. </span>Separation of concerns at the type level<a class="headerlink" href="#separation-of-concerns-at-the-type-level" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is aimed at primarily at graduate students, but advanced undergradutes are encouraged to work through it as well.</p>
</div>
<p>The overall approach is to separate recursion from structure by formalizing algebraic data types as initial F-algebras.</p>
<section id="key-concepts">
<h3><span class="section-number">5.6.1. </span>Key concepts<a class="headerlink" href="#key-concepts" title="Link to this heading"></a></h3>
<p>We first need to define some key concepts:</p>
<ul>
<li><p><a class="reference external" href="https://hseeberger.wordpress.com/2010/11/25/introduction-to-category-theory-in-scala">(Endo)functor</a>: a type constructor (generic collection) with a <code class="docutils literal notranslate"><span class="pre">map</span></code> method that satisfies <em>identity</em> and <em>composition</em> laws:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">identity</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span>
<span class="n">c</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">g</span><span class="w"> </span><span class="n">compose</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
<p>Some familiar examples of endofunctors are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Option</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List</span></code></p></li>
<li><p>generic trees such as <a class="reference external" href="https://github.com/lucproglangcourse/misc-explorations-scala/blob/master/orgchartGeneric.sc">org chart</a></p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Fix</span></code>-combinator handles the <em>recursion</em> concern <em>for structures</em> and separates it from the nature of the structure itself.</p></li>
<li><p>Generalized <code class="docutils literal notranslate"><span class="pre">fold</span></code> = <em>catamorphism</em> (<code class="docutils literal notranslate"><span class="pre">cata</span></code>) for <em>breaking down</em> a data structure to a result value.</p></li>
<li><p><a class="reference external" href="https://www.fpcomplete.com/user/bartosz/understanding-algebras">F-algebra</a>: This is the argument to <code class="docutils literal notranslate"><span class="pre">fold</span></code>, which has a functor <code class="docutils literal notranslate"><span class="pre">F</span></code> and a carrier object, i.e., the result type of the fold.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unfold</span></code> = <em>anamorphism</em> for <em>building up</em> a data structure from some other value.</p></li>
<li><p><em>F-coalgebra</em>: This is the argument to <code class="docutils literal notranslate"><span class="pre">unfold</span></code> (generator), which also has a functor <code class="docutils literal notranslate"><span class="pre">F</span></code> and a carrier object, i.e., type of seed and generated values wrapped in the functor.</p></li>
<li><p><em>Initial F-algebra</em>: This is the least fixpoint of our functor <code class="docutils literal notranslate"><span class="pre">F</span></code> and equivalent to our original recursive type.
We obtain this by applying the <code class="docutils literal notranslate"><span class="pre">Fix</span></code>-combinator to <code class="docutils literal notranslate"><span class="pre">F</span></code>.</p></li>
<li><p>We get our original recursive behaviors back by combining <code class="docutils literal notranslate"><span class="pre">cata</span></code> and our specific F-algebraic version of the behavior.</p></li>
</ul>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>Practical applications</p>
</div>
</section>
<section id="id4">
<h3><span class="section-number">5.6.2. </span>Examples<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>It is perhaps best to look at some conventional and F-algebra-based examples side-by-side:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/lucproglangcourse/expressions-scala">expressions-scala</a> versus <a class="reference external" href="https://github.com/lucproglangcourse/expressions-algebraic-scala">expressions-algebraic-scala</a></p></li>
<li><p>Project 1a (shapes) versus Project 1b (shapes redone using F-algebras) on Sakai</p></li>
</ul>
<p>Some other examples are available <a class="reference external" href="https://github.com/lucproglangcourse/droste-explorations-scala/">here</a>.</p>
</section>
<section id="what-fix-does">
<h3><span class="section-number">5.6.3. </span>What <code class="docutils literal notranslate"><span class="pre">Fix</span></code> does<a class="headerlink" href="#what-fix-does" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Fix[F]</span></code> basically ties the “recursive knot” by applying the functor <code class="docutils literal notranslate"><span class="pre">F</span></code>  to itself.
This forms the <em>fixpoint</em> of the functor, allowing all structures built from the functor to have the same type, as opposed to nested types corresponding to the nesting of the structure.</p>
<p>For instance, we can represent the familiar aggregation of an item and an (optional) next node using the functor <code class="docutils literal notranslate"><span class="pre">F[A]</span> <span class="pre">=</span> <span class="pre">(Int,</span> <span class="pre">Option[A])</span></code>.
This enables  us to define linked lists:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nc">None</span><span class="p">)))))</span>
</pre></div>
</div>
<p>The problem is that the types of these lists are nested:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nc">None</span><span class="p">)))))</span>
<span class="n">res0</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">[(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">[(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">None</span><span class="p">.</span><span class="k">type</span><span class="p">)])])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nc">Some</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="nc">Some</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="nc">None</span><span class="p">)))))</span>
</pre></div>
</div>
<p>so that lists of different lengths have different types.</p>
<p>By using a suitable <code class="docutils literal notranslate"><span class="pre">Fix</span></code> over our functor, they all end up having the <em>same</em> type, namely <code class="docutils literal notranslate"><span class="pre">Fix</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Fix</span><span class="p">(</span><span class="n">unFix</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Fix</span><span class="p">]))</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">Fix</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">Fix</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">Fix</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nc">None</span><span class="p">))))))))</span>
<span class="n">res1</span><span class="p">:</span><span class="w"> </span><span class="nc">Fix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Fix</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nc">Some</span><span class="p">(</span><span class="nc">Fix</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="nc">Some</span><span class="p">(</span><span class="nc">Fix</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="nc">None</span><span class="p">))))))))</span>
</pre></div>
</div>
<p>That’s why we usually define such types recursively to begin with.</p>
</section>
<section id="generalized-fold-catamorphism">
<h3><span class="section-number">5.6.4. </span>Generalized fold (catamorphism)<a class="headerlink" href="#generalized-fold-catamorphism" title="Link to this heading"></a></h3>
<p>The next question is what the implementation of the universal fold method for <code class="docutils literal notranslate"><span class="pre">Fix</span></code> looks like, also known as the <em>catamorphism</em>.
Continuing with our <code class="docutils literal notranslate"><span class="pre">Fix</span></code> over <code class="docutils literal notranslate"><span class="pre">(Int,</span> <span class="pre">Option[A])</span></code> example, we perform recursion over this functor by using <code class="docutils literal notranslate"><span class="pre">map</span></code>, which preserves the first component and invokes a suitable <code class="docutils literal notranslate"><span class="pre">map</span></code> on the second component of the pair:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Fix</span><span class="p">(</span><span class="n">unFix</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Fix</span><span class="p">])):</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">cata</span><span class="p">[</span><span class="nc">B</span><span class="p">](</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">B</span><span class="p">]))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">B</span><span class="p">):</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">((</span><span class="bp">this</span><span class="p">.</span><span class="n">unFix</span><span class="p">.</span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="bp">this</span><span class="p">.</span><span class="n">unFix</span><span class="p">.</span><span class="n">_2</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="p">.</span><span class="n">cata</span><span class="p">(</span><span class="n">f</span><span class="p">))))</span>
</pre></div>
</div>
<p>Now we can define <em>algebras</em> on our functor, such as:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">Int</span><span class="p">])):</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="k">match</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="nc">None</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span>

<span class="n">res1</span><span class="p">.</span><span class="n">cata</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="c1">// 6</span>
</pre></div>
</div>
<p>These are very similar to visitors without the responsibility to traverse the structure.
That is why they are not recursive.
Instead, the catamorphism takes care of the recursion.</p>
<p>For an arbitrary functor <code class="docutils literal notranslate"><span class="pre">F</span></code>, the code looks like this:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Fix</span><span class="p">(</span><span class="n">unFix</span><span class="p">:</span><span class="w"> </span><span class="nc">F</span><span class="p">[</span><span class="nc">Fix</span><span class="p">]):</span>
<span class="w">  </span><span class="k">def</span><span class="w"> </span><span class="nf">cata</span><span class="p">[</span><span class="nc">B</span><span class="p">](</span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">F</span><span class="p">[</span><span class="nc">B</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">B</span><span class="p">):</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="bp">this</span><span class="p">.</span><span class="n">unFix</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="p">.</span><span class="n">cata</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>
</pre></div>
</div>
<p>For an arbitrary <em>carrier type</em> <code class="docutils literal notranslate"><span class="pre">B</span></code>, the argument <code class="docutils literal notranslate"><span class="pre">f</span></code> of type <code class="docutils literal notranslate"><span class="pre">F[B]</span> <span class="pre">=&gt;</span> <span class="pre">B</span></code> is an <code class="docutils literal notranslate"><span class="pre">F</span></code>-algebra.
<code class="docutils literal notranslate"><span class="pre">Fix[F]</span></code> is the <em>initial</em> <code class="docutils literal notranslate"><span class="pre">F</span></code>-algebra, and the catamorphism <code class="docutils literal notranslate"><span class="pre">cata</span></code> produces the unique structure-preserving mapping (homomorphism) between <code class="docutils literal notranslate"><span class="pre">Fix[F]</span></code> and <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
</section>
<section id="key-insights">
<h3><span class="section-number">5.6.5. </span>Key insights<a class="headerlink" href="#key-insights" title="Link to this heading"></a></h3>
<p>By taking an F-algebraic perspective on recursive algebraic data types, we are able to recognize previously non-obvious structural commonalities among them.</p>
<ul class="simple">
<li><p>non-generic:  <code class="docutils literal notranslate"><span class="pre">Nat</span></code>, <code class="docutils literal notranslate"><span class="pre">Expr</span></code>, <code class="docutils literal notranslate"><span class="pre">Shape</span></code>, etc.</p></li>
<li><p>generic: <code class="docutils literal notranslate"><span class="pre">List</span></code>, <code class="docutils literal notranslate"><span class="pre">Tree</span></code>, <code class="docutils literal notranslate"><span class="pre">OrgChart</span></code>, etc.</p></li>
</ul>
<p>It also helps to study these questions:</p>
<ul class="simple">
<li><p>How are, say, <code class="docutils literal notranslate"><span class="pre">Option</span></code>, <code class="docutils literal notranslate"><span class="pre">List</span></code>, and <code class="docutils literal notranslate"><span class="pre">Tree</span></code> related?</p></li>
<li><p>How does</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Option</span></code> relate to <code class="docutils literal notranslate"><span class="pre">List</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List</span></code> relate to <code class="docutils literal notranslate"><span class="pre">Tree</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tree</span></code> relate to ?!?</p></li>
<li><p>…</p></li>
</ul>
</li>
<li><p>How do we represent an <em>empty</em> structure?</p></li>
<li><p>Why aren’t there multiple branches in the definition of <code class="docutils literal notranslate"><span class="pre">cata</span></code> above?
When does the recursion terminate?</p></li>
<li><p>Is <code class="docutils literal notranslate"><span class="pre">cata</span></code> tail-recursive? Can or should it be?</p></li>
</ul>
<p>On the behavioral side, we recognize the great potential for code reuse resulting from common abstractions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://typelevel.org/cats">Cats library of high-level abstractions</a></p></li>
<li><p><a class="reference external" href="https://github.com/higherkindness/droste">Droste library of recursion schemes</a></p></li>
<li><p>Various other <a class="reference external" href="http://typelevel.org/projects">Typelevel.scala projects</a></p></li>
</ul>
<p>For more details on F-algebras and datatype-generic programming, please take a look at these references:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gist.github.com/jdegoes/97459c0045f373f4eaf126998d8f65dc">Advanced Functional Programming with Scala</a></p></li>
<li><p><a class="reference external" href="https://www.fpcomplete.com/user/bartosz/understanding-algebras">Understanding F-Algebras</a></p></li>
<li><p><a class="reference external" href="https://www.cs.ox.ac.uk/jeremy.gibbons/publications/origami.pdf">Gibbons: origami programming</a> (advanced)</p></li>
<li><p><a class="reference external" href="http://www.cs.utexas.edu/~wcook/Drafts/2012/ecoop2012.pdf">Oliveira &amp; Cook: F-algebras in Java</a> (advanced)</p></li>
<li><p><a class="reference external" href="http://www.doscienceto.it/blog/posts/2020-09-16-change.html">Joe Warren’s four ways to make change in Scala</a></p></li>
<li><p><a class="reference external" href="https://blog.sumtypeofway.com/archive.html">Patrick Thomson’s blog post series on recursion schemes</a></p></li>
</ul>
<p>If you want to dig a bit deeper, check out a generalization of <code class="docutils literal notranslate"><span class="pre">map</span></code> called <a class="reference external" href="https://www.cs.ox.ac.uk/jeremy.gibbons/publications/iterator.pdf">traverse</a>.
Some of our examples include implementations of <code class="docutils literal notranslate"><span class="pre">traverse</span></code>.</p>
</section>
</section>
<section id="other-useful-abstractions">
<h2><span class="section-number">5.7. </span>Other useful abstractions<a class="headerlink" href="#other-useful-abstractions" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is aimed at primarily at graduate students, but advanced undergradutes are encouraged to work through it as well.</p>
</div>
<p>In this section, we will discuss a few more useful yet relatively simple abstractions.</p>
<section id="monoid">
<h3><span class="section-number">5.7.1. </span>Monoid<a class="headerlink" href="#monoid" title="Link to this heading"></a></h3>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Monoid_(disambiguation)">Monoid</a> is a type with an associative binary operation and an identity element.
(This is equivalent to a semigroup with an identity element.)
Examples include:</p>
<ul class="simple">
<li><p>integers with addition and zero</p></li>
<li><p>integers with multiplication one</p></li>
<li><p>lists with append and the empty list</p></li>
<li><p>strings with concatenation and the empty string</p></li>
</ul>
<p>The <em>monoid laws</em> arise from the monoid’s definition: the operation must be associative, and the identity element must be a left and right identity.</p>
<p>Examples of monoids using the Scalaz library are available <a class="reference external" href="https://github.com/lucproglangcourse/scalaz-explorations-scala/tree/master/monoid.sc">here</a></p>
</section>
<section id="monad">
<h3><span class="section-number">5.7.2. </span>Monad<a class="headerlink" href="#monad" title="Link to this heading"></a></h3>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Monad_(functional_programming)">Monad</a> is a type constructor (generic collection) with two operations, <code class="docutils literal notranslate"><span class="pre">point</span></code> (also called <code class="docutils literal notranslate"><span class="pre">return</span></code> or <code class="docutils literal notranslate"><span class="pre">unit</span></code>) and <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> (also called <code class="docutils literal notranslate"><span class="pre">bind</span></code>).
Monads are an effective way to represent the <em>context</em> of a computation in which the computation is “wrapped”.
The monad abstraction thereby enables one to separate the concerns of the computation itself and its context.
Examples include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Option</span></code> and <code class="docutils literal notranslate"><span class="pre">Try</span></code>: potential failure in a computation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">List</span></code>: nondeterminism in a computation, meaning that the computation might have multiple results</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Id</span></code>: the identity monad, a wrapper that doesn’t actually do anything</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Future</span></code>: the computation takes place asynchronously (in the background)</p></li>
</ul>
<p>Examples of monads using the Scalaz library are available <a class="reference external" href="https://github.com/lucproglangcourse/scalaz-explorations-scala/tree/master/monad.sc">here</a>.</p>
</section>
<section id="observations">
<h3><span class="section-number">5.7.3. </span>Observations<a class="headerlink" href="#observations" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The Scala library includes various structures that are effectively monads, especially those just mentioned.
What Scala does not define is a monad abstraction itself.</p></li>
<li><p>This is where libraries like Scalaz or Cats come in:
They define these abstractions in such a way that we can retrofit existing types or our own types to become instances of the desired abstractions, using the <em>Typeclass pattern</em>, a technique for representing Haskell-style typeclasses.</p></li>
<li><p>Examples of the Typeclass pattern are the <code class="docutils literal notranslate"><span class="pre">Functor</span></code> and <code class="docutils literal notranslate"><span class="pre">Traverse</span></code> instances in our expressions and shapes examples.</p></li>
<li><p>A good reference for learning Scalaz, a library that defines these various abstractions, is available <a class="reference external" href="http://eed3si9n.com/learning-scalaz">here</a>.</p></li>
</ul>
</section>
</section>
<section id="references">
<h2><span class="section-number">5.8. </span>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<div class="admonition-todo admonition" id="id12">
<p class="admonition-title">Todo</p>
<p>put chapter-level references here</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="50-representationinterpretation.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title"><span class="section-number">6. </span>Program Representation and Interpretation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="30-objectoriented.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">4. </span>The Object-Oriented Programming Paradigm</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2017-Present, Konstantin Läufer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">5. The Functional Programming Paradigm</a><ul>
<li><a class="reference internal" href="#core-elements">5.1. Core Elements</a><ul>
<li><a class="reference internal" href="#expression-oriented-computation">5.1.1. Expression-Oriented Computation</a></li>
<li><a class="reference internal" href="#immutability">5.1.2. Immutability</a></li>
<li><a class="reference internal" href="#first-class-and-higher-order-functions">5.1.3. First-Class and Higher-Order Functions</a></li>
<li><a class="reference internal" href="#recursion">5.1.4. Recursion</a></li>
<li><a class="reference internal" href="#pattern-matching">5.1.5. Pattern Matching</a></li>
<li><a class="reference internal" href="#lazy-evaluation">5.1.6. Lazy Evaluation</a></li>
<li><a class="reference internal" href="#other-elements">5.1.7. Other Elements</a></li>
<li><a class="reference internal" href="#examples-across-languages">5.1.8. Examples Across Languages</a></li>
<li><a class="reference internal" href="#discussion">5.1.9. Discussion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solving-problems-using-built-in-types-and-behaviors">5.2. Solving problems using built-in types and behaviors</a><ul>
<li><a class="reference internal" href="#examples">5.2.1. Examples</a></li>
<li><a class="reference internal" href="#other-important-operations-on-collections">5.2.2. Other important operations on collections</a></li>
<li><a class="reference internal" href="#dealing-with-successive-failures">5.2.3. Dealing with successive failures</a></li>
<li><a class="reference internal" href="#challenges">5.2.4. Challenges</a></li>
<li><a class="reference internal" href="#modularity-and-dependency-injection-in-the-functional-style">5.2.5. Modularity and dependency injection in the functional style</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defining-algebraic-data-types">5.3. Defining algebraic data types</a><ul>
<li><a class="reference internal" href="#separation-of-structural-concerns">5.3.1. Separation of structural concerns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#behaviors-on-algebraic-data-types">5.4. Behaviors on algebraic data types</a><ul>
<li><a class="reference internal" href="#behaviors-based-on-recursive-thinking">5.4.1. Behaviors based on recursive thinking</a></li>
<li><a class="reference internal" href="#separation-of-behavioral-concerns">5.4.2. Separation of behavioral concerns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-closer-look-at-predefined-behaviors-on-lists">5.5. A closer look at predefined behaviors on lists</a></li>
<li><a class="reference internal" href="#separation-of-concerns-at-the-type-level">5.6. Separation of concerns at the type level</a><ul>
<li><a class="reference internal" href="#key-concepts">5.6.1. Key concepts</a></li>
<li><a class="reference internal" href="#id4">5.6.2. Examples</a></li>
<li><a class="reference internal" href="#what-fix-does">5.6.3. What <code class="docutils literal notranslate"><span class="pre">Fix</span></code> does</a></li>
<li><a class="reference internal" href="#generalized-fold-catamorphism">5.6.4. Generalized fold (catamorphism)</a></li>
<li><a class="reference internal" href="#key-insights">5.6.5. Key insights</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-useful-abstractions">5.7. Other useful abstractions</a><ul>
<li><a class="reference internal" href="#monoid">5.7.1. Monoid</a></li>
<li><a class="reference internal" href="#monad">5.7.2. Monad</a></li>
<li><a class="reference internal" href="#observations">5.7.3. Observations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">5.8. References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/documentation_options.js?v=37602519"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>